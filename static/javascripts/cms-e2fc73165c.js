function collapsibleTableBodies(e){for(var t=e.querySelectorAll(".header"),n=0;n<t.length;n++){var r=t[n];r.classList.contains("empty")||r.addEventListener("click",function(e){e.target.parentElement.parentElement.classList.toggle("collapsed")})}}function ethnicityDataValueFields(e){var t,n;e=e;"querySelector"in document&&"addEventListener"in document&&Function.prototype.bind&&function(){e&&(t=e.querySelector("select.ethnicity-categorisation"),n=e.querySelector("input.broad-values"),t&&n&&(t.addEventListener("change",function(){r()}.bind(this)),r()))}();function r(){"true"==t.selectedOptions[0].getAttribute("data-parents")?n.removeAttribute("disabled"):(n.checked=!1,n.setAttribute("disabled","disabled"))}}!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.accessibleAutocomplete=t():e.accessibleAutocomplete=t()}(this,function(){return function(n){function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var o={};return r.m=n,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=1)}([function(o,e,t){!function(){"use strict";function l(){}function n(e,t){var n,r,o,a,u=f;for(a=arguments.length;2<a--;)p.push(arguments[a]);for(t&&null!=t.children&&(p.length||p.push(t.children),delete t.children);p.length;)if((r=p.pop())&&void 0!==r.pop)for(a=r.length;a--;)p.push(r[a]);else!0!==r&&!1!==r||(r=null),(o="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r=String(r):"string"!=typeof r&&(o=!1)),o&&n?u[u.length-1]+=r:u===f?u=[r]:u.push(r),n=o;var i=new l;return i.nodeName=e,i.children=u,i.attributes=null==t?void 0:t,i.key=null==t?void 0:t.key,void 0!==q.vnode&&q.vnode(i),i}function A(e,t){for(var n in t)e[n]=t[n];return e}function a(e){!e.__d&&(e.__d=!0)&&1==r.push(e)&&(q.debounceRendering||setTimeout)(t)}function t(){var e,t=r;for(r=[];e=t.pop();)e.__d&&L(e)}function T(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function x(e){var t=A({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function D(e){e.parentNode&&e.parentNode.removeChild(e)}function d(e,t,n,r,o){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),r&&r(e);else if("class"!==t||o)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var a in n)a in r||(e.style[a]="");for(var a in r)e.style[a]="number"==typeof r[a]&&!1===_.test(a)?r[a]+"px":r[a]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var u=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,s,u):e.removeEventListener(t,s,u),(e.__l||(e.__l={}))[t]=r}else if("list"!==t&&"type"!==t&&!o&&t in e)(function(e,t,n){try{e[t]=n}catch(e){}})(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t);else{var i=o&&t!==(t=t.replace(/^xlink\:?/,""));null==r||!1===r?i?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(i?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function s(e){return this.__l[e.type](q.event&&q.event(e)||e)}function N(){for(var e;e=M.pop();)q.afterMount&&q.afterMount(e),e.componentDidMount&&e.componentDidMount()}function R(e,t,n,r,o,a){B++||(m=null!=o&&void 0!==o.ownerSVGElement,h=null!=e&&!("__preactattr_"in e));var u=w(e,t,n,r,a);return o&&u.parentNode!==o&&o.appendChild(u),--B||(h=!1,a||N()),u}function w(e,t,n,r,o){var a,u,i=e,l=m;if(null==t&&(t=""),"string"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||o)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),I(e,!0))),i.__preactattr_=!0,i;if("function"==typeof t.nodeName)return function(e,t,n,r){for(var o=e&&e._component,a=o,u=e,i=o&&e._componentConstructor===t.nodeName,l=i,s=x(t);o&&!l&&(o=o.__u);)l=o.constructor===t.nodeName;return o&&l&&(!r||o._component)?(P(o,s,3,n,r),e=o.base):(a&&!i&&(j(a),e=u=null),o=S(t.nodeName,s,n),e&&!o.__b&&(o.__b=e,u=null),P(o,s,1,n,r),e=o.base,u&&e!==u&&(u._component=null,I(u,!1))),e}(e,t,n,r);if(m="svg"===t.nodeName||"foreignObject"!==t.nodeName&&m,(!e||!T(e,String(t.nodeName)))&&(a=String(t.nodeName),(u=m?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).__n=a,i=u,e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),I(e,!0)}var s=i.firstChild,c=i.__preactattr_||(i.__preactattr_={}),p=t.children;return!h&&p&&1===p.length&&"string"==typeof p[0]&&null!=s&&void 0!==s.splitText&&null==s.nextSibling?s.nodeValue!=p[0]&&(s.nodeValue=p[0]):(p&&p.length||null!=s)&&function(e,t,n,r,o){var a,u,i,l,s=e.childNodes,c=[],p={},d=0,f=0,_=s.length,m=0,h=t?t.length:0;if(0!==_)for(var v=0;v<_;v++){var g=s[v],b=g.__preactattr_,y=h&&b?g._component?g._component.__k:b.key:null;null!=y?(d++,p[y]=g):(b||(void 0!==g.splitText?!o||g.nodeValue.trim():o))&&(c[m++]=g)}if(0!==h)for(var v=0;v<h;v++){i=t[v],l=null;var y=i.key;if(null!=y)d&&void 0!==p[y]&&(l=p[y],p[y]=void 0,d--);else if(!l&&f<m)for(a=f;a<m;a++)if(void 0!==c[a]&&(O=u=c[a],E=o,"string"==typeof(C=i)||"number"==typeof C?void 0!==O.splitText:"string"==typeof C.nodeName?!O._componentConstructor&&T(O,C.nodeName):E||O._componentConstructor===C.nodeName)){l=u,c[a]=void 0,a===m-1&&m--,a===f&&f++;break}(l=w(l,i,n,r))&&l!==e&&(_<=v?e.appendChild(l):l!==s[v]&&(l===s[v+1]?D(s[v]):e.insertBefore(l,s[v]||null)))}var O,C,E;if(d)for(var v in p)void 0!==p[v]&&I(p[v],!1);for(;f<=m;)void 0!==(l=c[m--])&&I(l,!1)}(i,p,n,r,h||null!=c.dangerouslySetInnerHTML),function(e,t,n){var r;for(r in n)t&&null!=t[r]||null==n[r]||d(e,r,n[r],n[r]=void 0,m);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||d(e,r,n[r],n[r]=t[r],m)}(i,t.attributes,c),m=l,i}function I(e,t){var n=e._component;n?j(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||D(e),u(e))}function u(e){for(e=e.lastChild;e;){var t=e.previousSibling;I(e,!0),e=t}}function S(e,t,n){var r,o=v[e.name];if(e.prototype&&e.prototype.render?(r=new e(t,n),c.call(r,t,n)):((r=new c(t,n)).constructor=e,r.render=i),o)for(var a=o.length;a--;)if(o[a].constructor===e){r.__b=o[a].__b,o.splice(a,1);break}return r}function i(e,t,n){return this.constructor(e,n)}function P(e,t,n,r,o){e.__x||(e.__x=!0,(e.__r=t.ref)&&delete t.ref,(e.__k=t.key)&&delete t.key,!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.__c||(e.__c=e.context),e.context=r),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&!1===q.syncComponentUpdates&&e.base?a(e):L(e,1,o)),e.__r&&e.__r(e))}function L(e,t,n,r){if(!e.__x){var o,a,u,i=e.props,l=e.state,s=e.context,c=e.__p||i,p=e.__s||l,d=e.__c||s,f=e.base,_=e.__b,m=f||_,h=e._component,v=!1;if(f&&(e.props=c,e.state=p,e.context=d,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(i,l,s)?v=!0:e.componentWillUpdate&&e.componentWillUpdate(i,l,s),e.props=i,e.state=l,e.context=s),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!v){o=e.render(i,l,s),e.getChildContext&&(s=A(A({},s),e.getChildContext()));var g,b,y=o&&o.nodeName;if("function"==typeof y){var O=x(o);(a=h)&&a.constructor===y&&O.key==a.__k?P(a,O,1,s,!1):(g=a,e._component=a=S(y,O,s),a.__b=a.__b||_,a.__u=e,P(a,O,0,s,!1),L(a,1,n,!0)),b=a.base}else u=m,(g=h)&&(u=e._component=null),(m||1===t)&&(u&&(u._component=null),b=R(u,o,s,n||!f,m&&m.parentNode,!0));if(m&&b!==m&&a!==h){var C=m.parentNode;C&&b!==C&&(C.replaceChild(b,m),g||(m._component=null,I(m,!1)))}if(g&&j(g),(e.base=b)&&!r){for(var E=e,T=e;T=T.__u;)(E=T).base=b;b._component=E,b._componentConstructor=E.constructor}}if(!f||n?M.unshift(e):v||(N(),e.componentDidUpdate&&e.componentDidUpdate(c,p,d),q.afterUpdate&&q.afterUpdate(e)),null!=e.__h)for(;e.__h.length;)e.__h.pop().call(e);B||r||N()}}function j(e){q.beforeUnmount&&q.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n,r,o=e._component;o?j(o):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),D(e.__b=t),r=(n=e).constructor.name,(v[r]||(v[r]=[])).push(n),u(t)),e.__r&&e.__r(null)}function c(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{}}var q={},p=[],f=[],_=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,r=[],M=[],B=0,m=!1,h=!1,v={};A(c.prototype,{setState:function(e,t){var n=this.state;this.__s||(this.__s=A({},n)),A(n,"function"==typeof e?e(n,this.props):e),t&&(this.__h=this.__h||[]).push(t),a(this)},forceUpdate:function(e){e&&(this.__h=this.__h||[]).push(e),L(this,2)},render:function(){}});var e={h:n,createElement:n,cloneElement:function(e,t){return n(e.nodeName,A(A({},e.attributes),t),2<arguments.length?[].slice.call(arguments,2):e.children)},Component:c,render:function(e,t,n){return R(n,e,{},!1,t,!1)},rerender:t,options:q};o.exports=e}()},function(e,t,n){e.exports=n(2)},function(e,t,n){"use strict";function o(e){if(!e.element)throw new Error("element is not defined");if(!e.id)throw new Error("id is not defined");if(!e.source)throw new Error("source is not defined");var n;Array.isArray(e.source)&&(e.source=(n=e.source,function(t,e){e(n.filter(function(e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}))})),(0,u.render)((0,u.createElement)(l.default,e),e.element)}var r,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=n(0),i=n(3),l=(r=i)&&r.__esModule?r:{default:r};o.enhanceSelectElement=function(n){if(!n.selectElement)throw new Error("selectElement is not defined");if(!n.source){var e=[].filter.call(n.selectElement.options,function(e){return e.value||n.preserveNullOptions});n.source=e.map(function(e){return e.textContent||e.innerText})}if(n.onConfirm=n.onConfirm||function(t){var e=[].filter.call(n.selectElement.options,function(e){return(e.textContent||e.innerText)===t})[0];e&&(e.selected=!0)},n.selectElement.value||void 0===n.defaultValue){var t=n.selectElement.options[n.selectElement.options.selectedIndex];n.defaultValue=t.textContent||t.innerText}void 0===n.name&&(n.name=""),void 0===n.id&&(void 0===n.selectElement.id?n.id="":n.id=n.selectElement.id),void 0===n.autoselect&&(n.autoselect=!0);var r=document.createElement("span");n.selectElement.parentNode.insertBefore(r,n.selectElement),o(a({},n,{element:r})),n.selectElement.style.display="none",n.selectElement.id=n.selectElement.id+"-select"},e.exports=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function p(){return!(!navigator.userAgent.match(/(iPod|iPhone|iPad)/g)||!navigator.userAgent.match(/AppleWebKit/g))}t.__esModule=!0,t.default=void 0;var o,a,u,H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W=n(0),$=r(n(4)),i=r(n(5)),l={13:"enter",27:"escape",32:"space",38:"up",40:"down"},K=((u=document.createElement("x")).style.cssText="pointer-events:auto","auto"===u.style.pointerEvents),s=(a=o=function(n){function e(e){var t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,n.call(this,e));return t.elementReferences={},t.state={focused:null,hovered:null,menuOpen:!1,options:e.defaultValue?[e.defaultValue]:[],query:e.defaultValue,selected:null},t.handleComponentBlur=t.handleComponentBlur.bind(t),t.handleKeyDown=t.handleKeyDown.bind(t),t.handleUpArrow=t.handleUpArrow.bind(t),t.handleDownArrow=t.handleDownArrow.bind(t),t.handleEnter=t.handleEnter.bind(t),t.handlePrintableKey=t.handlePrintableKey.bind(t),t.handleOptionBlur=t.handleOptionBlur.bind(t),t.handleOptionClick=t.handleOptionClick.bind(t),t.handleOptionFocus=t.handleOptionFocus.bind(t),t.handleOptionMouseDown=t.handleOptionMouseDown.bind(t),t.handleOptionMouseEnter=t.handleOptionMouseEnter.bind(t),t.handleOptionMouseOut=t.handleOptionMouseOut.bind(t),t.handleInputBlur=t.handleInputBlur.bind(t),t.handleInputChange=t.handleInputChange.bind(t),t.handleInputFocus=t.handleInputFocus.bind(t),t.pollInputElement=t.pollInputElement.bind(t),t.getDirectInputChanges=t.getDirectInputChanges.bind(t),t}return t=e,"function"!=typeof(r=n)&&null!==r||(t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)),e.prototype.componentDidMount=function(){this.pollInputElement()},e.prototype.componentWillUnmount=function(){clearTimeout(this.$pollInput)},e.prototype.pollInputElement=function(){var e=this;this.getDirectInputChanges(),this.$pollInput=setTimeout(function(){e.pollInputElement()},100)},e.prototype.getDirectInputChanges=function(){var e=this.elementReferences[-1];e&&e.value!==this.state.query&&this.handleInputChange({target:{value:e.value}})},e.prototype.componentDidUpdate=function(e,t){var n=this.state.focused,r=null===n,o=t.focused!==n;o&&!r&&this.elementReferences[n].focus();var a=-1===n,u=o&&null===t.focused;if(a&&u){var i=this.elementReferences[n];i.setSelectionRange(0,i.value.length)}},e.prototype.hasAutoselect=function(){return!p()&&this.props.autoselect},e.prototype.templateInputValue=function(e){var t=this.props.templates&&this.props.templates.inputValue;return t?t(e):e},e.prototype.templateSuggestion=function(e){var t=this.props.templates&&this.props.templates.suggestion;return t?t(e):e},e.prototype.handleComponentBlur=function(e){var t=this.state,n=t.options,r=t.query,o=t.selected,a=void 0;this.props.confirmOnBlur?(a=e.query||r,this.props.onConfirm(n[o])):a=r,this.setState({focused:null,menuOpen:e.menuOpen||!1,query:a,selected:null})},e.prototype.handleOptionBlur=function(e,t){var n=this.state,r=n.focused,o=n.menuOpen,a=n.options,u=n.selected,i=null===e.relatedTarget,l=e.relatedTarget===this.elementReferences[-1],s=r!==t&&-1!==r;if(!s&&i||!s&&!l){var c=o&&p();this.handleComponentBlur({menuOpen:c,query:this.templateInputValue(a[u])})}},e.prototype.handleInputBlur=function(e){var t=this.state,n=t.focused,r=t.menuOpen,o=t.options,a=t.query,u=t.selected;if(-1===n){var i=r&&p(),l=p()?a:this.templateInputValue(o[u]);this.handleComponentBlur({menuOpen:i,query:l})}},e.prototype.handleInputChange=function(e){var n=this,t=this.props,r=t.minLength,o=t.source,a=t.showAllValues,u=this.hasAutoselect(),i=e.target.value,l=0===i.length,s=this.state.query.length!==i.length,c=i.length>=r;this.setState({query:i}),a||!l&&s&&c?o(i,function(e){var t=0<e.length;n.setState({menuOpen:t,options:e,selected:u&&t?0:-1})}):!l&&c||this.setState({menuOpen:!1,options:[]})},e.prototype.handleInputClick=function(e){this.handleInputChange(e)},e.prototype.handleInputFocus=function(e){this.setState({focused:-1})},e.prototype.handleOptionFocus=function(e){this.setState({focused:e,hovered:null,selected:e})},e.prototype.handleOptionMouseEnter=function(e,t){this.setState({hovered:t})},e.prototype.handleOptionMouseOut=function(e,t){this.setState({hovered:null})},e.prototype.handleOptionClick=function(e,t){var n=this.state.options[t],r=this.templateInputValue(n);this.props.onConfirm(n),this.setState({focused:-1,menuOpen:!1,query:r,selected:-1}),this.forceUpdate()},e.prototype.handleOptionMouseDown=function(e){e.preventDefault()},e.prototype.handleUpArrow=function(e){e.preventDefault();var t=this.state,n=t.menuOpen,r=t.selected;-1!==r&&n&&this.handleOptionFocus(r-1)},e.prototype.handleDownArrow=function(e){var t=this;if(e.preventDefault(),this.props.showAllValues&&!1===this.state.menuOpen)e.preventDefault(),this.props.source("",function(e){t.setState({menuOpen:!0,options:e,selected:0,focused:0,hovered:null})});else if(!0===this.state.menuOpen){var n=this.state,r=n.menuOpen,o=n.options,a=n.selected;a!==o.length-1&&r&&this.handleOptionFocus(a+1)}},e.prototype.handleSpace=function(e){var t=this;this.props.showAllValues&&!1===this.state.menuOpen&&(e.preventDefault(),this.props.source("",function(e){t.setState({menuOpen:!0,options:e})})),-1!==this.state.focused&&(e.preventDefault(),this.handleOptionClick(e,this.state.focused))},e.prototype.handleEnter=function(e){this.state.menuOpen&&(e.preventDefault(),0<=this.state.selected&&this.handleOptionClick(e,this.state.selected))},e.prototype.handlePrintableKey=function(e){var t=this.elementReferences[-1];e.target===t||t.focus()},e.prototype.handleKeyDown=function(e){switch(l[e.keyCode]){case"up":this.handleUpArrow(e);break;case"down":this.handleDownArrow(e);break;case"space":this.handleSpace(e);break;case"enter":this.handleEnter(e);break;case"escape":this.handleComponentBlur({query:this.state.query});break;default:(47<(t=e.keyCode)&&t<58||32===t||8===t||64<t&&t<91||95<t&&t<112||185<t&&t<193||218<t&&t<223)&&this.handlePrintableKey(e)}var t},e.prototype.render=function(){var o=this,e=this.props,t=e.cssNamespace,n=e.displayMenu,a=e.id,r=e.minLength,u=e.name,i=e.placeholder,l=e.required,s=e.showAllValues,c=e.tNoResults,p=e.tStatusQueryTooShort,d=e.tStatusNoResults,f=e.tStatusSelectedOption,_=e.tStatusResults,m=e.dropdownArrow,h=this.state,v=h.focused,g=h.hovered,b=h.menuOpen,y=h.options,O=h.query,C=h.selected,E=this.hasAutoselect(),T=-1===v,A=0===y.length,x=0!==O.length,D=O.length>=r,N=this.props.showNoOptionsFound&&T&&A&&x&&D,R=t+"__wrapper",w=t+"__input",I=null!==v?" "+w+"--focused":"",S=this.props.showAllValues?" "+w+"--show-all-values":" "+w+"--default",P=t+"__dropdown-arrow-down",L=-1!==v&&null!==v,j=t+"__menu",q=j+"--"+n,M=j+"--"+(b||N?"visible":"hidden"),B=t+"__option",k=t+"__hint",U=this.templateInputValue(y[C]),V=U&&0===U.toLowerCase().indexOf(O.toLowerCase())&&E?O+U.substr(O.length):"",G=K&&V,F=void 0;return s&&"string"==typeof(F=m({className:P}))&&(F=(0,W.createElement)("div",{className:t+"__dropdown-arrow-down-wrapper",dangerouslySetInnerHTML:{__html:F}})),(0,W.createElement)("div",{className:R,onKeyDown:this.handleKeyDown,role:"combobox","aria-expanded":b?"true":"false"},(0,W.createElement)($.default,{length:y.length,queryLength:O.length,minQueryLength:r,selectedOption:this.templateInputValue(y[C]),tQueryTooShort:p,tNoResults:d,tSelectedOption:f,tResults:_}),G&&(0,W.createElement)("span",null,(0,W.createElement)("input",{className:k,readonly:!0,tabIndex:"-1",value:V})),(0,W.createElement)("input",H({"aria-activedescendant":!!L&&a+"__option--"+v,"aria-owns":a+"__listbox",autoComplete:"off",className:""+w+I+S,id:a,onClick:function(e){return o.handleInputClick(e)},onBlur:this.handleInputBlur},{onInput:this.handleInputChange},{onFocus:this.handleInputFocus,name:u,placeholder:i,ref:function(e){o.elementReferences[-1]=e},type:"text",role:"textbox",required:l,value:O})),F,(0,W.createElement)("ul",{className:j+" "+q+" "+M,id:a+"__listbox",role:"listbox"},y.map(function(e,t){var n=(-1===v?C===t:v===t)&&null===g?" "+B+"--focused":"",r=t%2?" "+B+"--odd":"";return(0,W.createElement)("li",{"aria-selected":v===t,className:""+B+n+r,dangerouslySetInnerHTML:{__html:o.templateSuggestion(e)},id:a+"__option--"+t,key:t,onFocusOut:function(e){return o.handleOptionBlur(e,t)},onClick:function(e){return o.handleOptionClick(e,t)},onMouseDown:o.handleOptionMouseDown,onMouseEnter:function(e){return o.handleOptionMouseEnter(e,t)},onMouseOut:function(e){return o.handleOptionMouseOut(e,t)},ref:function(e){o.elementReferences[t]=e},role:"option",tabIndex:"-1"})}),N&&(0,W.createElement)("li",{className:B+" "+B+"--no-results"},c())))},e;var t,r}(W.Component),o.defaultProps={autoselect:!1,cssNamespace:"autocomplete",defaultValue:"",displayMenu:"inline",minLength:0,name:"input-autocomplete",placeholder:"",onConfirm:function(){},confirmOnBlur:!0,showNoOptionsFound:!0,showAllValues:!1,required:!1,tNoResults:function(){return"No results found"},dropdownArrow:i.default},a);t.default=s},function(e,t,n){"use strict";function u(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}t.__esModule=!0,t.default=void 0;var r,o,_=n(0),a=(o=r=function(a){function e(){for(var e,t,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t=u(this,a.call.apply(a,[this].concat(r))),t.state={bump:!1},u(t,e)}return t=e,"function"!=typeof(n=a)&&null!==n||(t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)),e.prototype.componentWillReceiveProps=function(e){e.queryLength!==this.props.queryLength&&this.setState(function(e){return{bump:!e.bump}})},e.prototype.render=function(){var e,t=this.props,n=t.length,r=t.queryLength,o=t.minQueryLength,a=t.selectedOption,u=t.tQueryTooShort,i=t.tNoResults,l=t.tSelectedOption,s=t.tResults,c=this.state.bump,p=r<o,d=0===n,f=a?l(a,n):"";return e=p?u(o):d?i():s(n,f),(0,_.createElement)("div",{"aria-atomic":"true","aria-live":"polite",role:"status",style:{border:"0",clip:"rect(0 0 0 0)",height:"1px",marginBottom:"-1px",marginRight:"-1px",overflow:"hidden",padding:"0",position:"absolute",whiteSpace:"nowrap",width:"1px"}},e,(0,_.createElement)("span",null,c?",":",,"))},e;var t,n}(_.Component),r.defaultProps={tQueryTooShort:function(e){return"Type in "+e+" or more characters for results."},tNoResults:function(){return"No search results."},tSelectedOption:function(e,t){return e+" (1 of "+t+") is selected."},tResults:function(e,t){return e+" "+(1===e?"result":"results")+" "+(1===e?"is":"are")+" available. "+t}},o);t.default=a},function(e,t,n){"use strict";t.__esModule=!0;var r=n(0);t.default=function(e){var t=e.className;return(0,r.createElement)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",className:t,focusable:"false"},(0,r.createElement)("g",{stroke:"none",fill:"none","fill-rule":"evenodd"},(0,r.createElement)("polygon",{fill:"#000000",points:"0 0 22 0 11 17"})))}}])});var govukGovernmentOrganisationsAutocomplete=function(r){r.source=function(e,t){var n=[].filter.call(r.selectElement.options,function(e){return""!=e.value}).map(function(e){var t=e.getAttribute("data-abbreviations");t=t?t.split("|"):[];var n=e.getAttribute("data-other-names");return n=n?n.split("|"):[],{current_name:e.label,abbreviations:t,other_names:n}}),o=e.trim().split(/\s+/).map(function(e){return new RegExp("\\b"+e,"i")});return t(n.map(function(e){var n=[e.current_name].concat(e.other_names).concat(e.abbreviations).filter(function(e){return e});e.resultPosition=null;for(var r=0;r<n.length;r++){var t=o.reduce(function(e,t){return matchPosition=n[r].search(t),-1<matchPosition&&(e.count+=1,(-1==e.lowestPosition||matchPosition<e.lowestPosition)&&(e.lowestPosition=matchPosition)),e},{count:0,lowestPosition:-1});t.count==o.length&&(null==e.resultPosition||t.lowestPosition<e.resultPosition)&&(e.resultPosition=t.lowestPosition)}return e}).filter(function(e){return null!=e.resultPosition}).sort(function(e,t){return e.resultPosition<t.resultPosition?-1:e.resultPosition>t.resultPosition?1:0}).map(function(e){return e.current_name}))},accessibleAutocomplete.enhanceSelectElement(r)};function showHideControl(o){if(document.querySelectorAll&&Function.prototype.bind&&"classList"in document.createElement("_")){o=o;var a=null;!function(){var e=o.getAttribute("aria-controls"),t=o.getAttribute("name");e&&(a=document.getElementById(e));if(a)for(var n=document.querySelectorAll("input[name="+t+"]"),r=n.length-1;0<=r;r--)n[r].addEventListener("change",i.bind(this));u(o.checked)}()}function u(e){e?a.classList.remove("js-hidden"):a.classList.add("js-hidden")}function i(e){u(o.checked),o.setAttribute("aria-expanded",o.checked)}}function ukCountriesSelect(e){var o,a;function u(e){for(var t=0,n=o.length-1;0<=n;n--)o[n].checked&&(t+=1);a.checked=t==o.length}function i(){for(var e=o.length-1;0<=e;e--)o[e].checked=a.checked}this.element=e,function(){if(!(this.element&&"querySelector"in this.element&&"querySelectorAll"in this.element))return;(a=document.createElement("input")).setAttribute("type","checkbox"),a.setAttribute("id","uk");var e=document.createElement("label");e.setAttribute("for","uk"),e.textContent="All (United Kingdom)";var t=document.createElement("div");t.setAttribute("class","multiple-choice uk"),t.appendChild(a),t.appendChild(e);var n=this.element.querySelector("legend");if(!n)return console.warn("missing legend for UK fieldset");if(n.parentElement.insertBefore(t,n.nextSibling),a){a.addEventListener("change",i);for(var r=(o=this.element.querySelectorAll("input.country")).length-1;0<=r;r--)o[r].addEventListener("change",u);u()}}()}var DATA_ERROR_DUPLICATION="duplication",DATA_ERROR_MISSING_DATA="missing data",DATA_ERROR_SETTINGS_ERROR="settings",DATA_ERROR_COMPLEX_DATA="complex data";function validateData(e,t,n){var r=_.clone(e),o=r.shift(),a=_.map(o,function(e){return e.trim().toLowerCase()}),u=index_of_column_named(a,t);if(null===u)return[{error:"could not find data column",column:t,errorType:DATA_ERROR_SETTINGS_ERROR}];if(null!==n){var i=index_of_column_named(a,n);return null===i?[{error:"could not find data column",column:n,errorType:DATA_ERROR_SETTINGS_ERROR}]:validateGroupedData(r,u,i,t,n)}return validateSimpleData(r,u,t)}function validateDataDuplicatesOnly(e,t,n){var r=_.clone(e),o=r.shift(),a=_.map(o,function(e){return e.trim().toLowerCase()}),u=index_of_column_named(a,t);if(null===u)return[{error:"could not find data column",column:t}];if(null!==n){var i=index_of_column_named(a,n);return null===i?[{error:"could not find data column",column:n}]:validateGroupedDataDuplicates(r,u,i)}return validateSimpleData(r,u)}function validateSimpleData(e,n,r){var o=[],t=_.uniq(_.map(e,function(e){return e[n]}));if(t.length===e.length)return[];if(e.length%t.length==0)return[{errorType:DATA_ERROR_COMPLEX_DATA}];var a={};return _.forEach(e,function(e){var t=e[n];t in a?"added to errors"!==a[t]&&(o.push({error:"duplicate data",category:t,categoryColumn:r,errorType:DATA_ERROR_DUPLICATION}),a[t]="added to errors"):a[t]="value in dict"}),o}function validateGroupedData(e,t,n,r,o){var a=validateGroupedDataCompleteness(e,t,n,r,o),u=validateGroupedDataDuplicates(e,t,n,r,o);return a.concat(u)}function validateGroupedDataCompleteness(e,n,r,o,a){var t=_.uniq(_.map(e,function(e){return e[n]})),u=_.uniq(_.map(e,function(e){return e[r]})),i=[],l=_.object(_.map(t,function(t){return[t,_.map(_.filter(e,function(e){return e[n]===t}),function(e){return e[r]})]}));return _.forEach(t,function(t){_.forEach(u,function(e){_.contains(l[t],e)||i.push({error:"missing data",category:t,group:e,categoryColumn:o,groupColumn:a,errorType:DATA_ERROR_MISSING_DATA})})}),i}function validateGroupedDataDuplicates(e,r,o,a,u){var i=[],l={};return _.forEach(e,function(e){var t=e[r],n=e[o];t in l?n in l[t]?i.push({error:"duplicate data",category:e[r],group:e[o],categoryColumn:a,groupColumn:u,errorType:DATA_ERROR_DUPLICATION}):l[t][n]=1:(l[t]={},l[t][n]=1)}),i}function errorDescription(e){switch(e.errorType){case DATA_ERROR_SETTINGS_ERROR:return"Column '"+e.column+"' not found";case DATA_ERROR_MISSING_DATA:return"The data is missing a row for "+e.categoryColumn+" = '"+e.category+"' and "+e.groupColumn+" = '"+e.group+"'";case DATA_ERROR_DUPLICATION:return"group"in e?"The data has duplicate entries for the rows with "+e.categoryColumn+" = '"+e.category+"' and "+e.groupColumn+" = '"+e.group+"'":"The data has duplicate entries for "+e.categoryColumn+" = '"+e.category+"'"}}function errorResolutionHint(e){switch(e.errorType){case DATA_ERROR_SETTINGS_ERROR:return"Make sure the column values selected for this table are valid";case DATA_ERROR_MISSING_DATA:return"Add rows to your source spreadsheet and try again";case DATA_ERROR_DUPLICATION:return"Remove data rows in your source spreadsheet and try again"}}if("undefined"!=typeof exports){var _=require("../charts/vendor/underscore-min"),index_of_column_named=(dataTools=require("../charts/rd-data-tools")).index_of_column_named;exports.validateSimpleData=validateSimpleData,exports.validateGroupedData=validateGroupedData,exports.validateData=validateData,exports.DATA_ERROR_DUPLICATION=DATA_ERROR_DUPLICATION,exports.DATA_ERROR_MISSING_DATA=DATA_ERROR_MISSING_DATA,exports.DATA_ERROR_COMPLEX_DATA=DATA_ERROR_COMPLEX_DATA,exports.DATA_ERROR_SETTINGS_ERROR=DATA_ERROR_SETTINGS_ERROR}var defaultParentColor="#2B8CC4",defaultChildColor="#B3CBD9",VERSION="1.1",BAR_CHART="bar",LINE_CHART="line",COMPONENT_CHART="component",PANEL_BAR_CHART="panel_bar",PANEL_LINE_CHART="panel_line";function buildChartObject(e,t,n,r,o,a,u,i,l,s,c,p,d){var f=d||"[None]";switch(t.toLowerCase()){case BAR_CHART:var m=_.clone(e),h=m.shift();return o===f||null===o?barchartSingleObject(h,m,r,a,u,l,s,c,p):barchartDoubleObject(h,m,r,o,a,u,l,s,c,p);case LINE_CHART:return linechartObject(e,r,o,l,s,c,p,u);case COMPONENT_CHART:return componentChartObject(e,r,o,l,s,c,p,row_order_column,i);case PANEL_BAR_CHART:return panelBarchartObject(e,r,o,l,s,c,p,u,i);case PANEL_LINE_CHART:return panelLinechartObject(e,o,r,l,s,c,p,i);default:return null}}function barchartObject(e,t,n,r,o,a,u,i,l){var s=_.clone(e),c=s.shift();return isSimpleBarchart(n)?barchartSingleObject(c,s,t,r,o,a,u,i,l):barchartDoubleObject(c,s,t,n,r,o,a,u,i,l)}function isSimpleBarchart(e){return"[None]"===e||null===e}function barchartSingleObject(e,t,n,r,o,a,u,i,l){var s=getIndices(e,n,null,r,o),c=uniqueCategories(t,s.category,s.order),p=_.map(c,function(e){return valueForCategory(t,s.category,s.value,s.parent,e)}),d=[];return null!==s.parent&&(d=_.unique(_.map(t,function(e){return e[s.parent]}))),{type:"bar",title:{text:a},parent_child:null!==s.parent,xAxis:{title:{text:u},categories:c},yAxis:{title:{text:i}},series:[{name:n,data:p}],number_format:l,parents:d,version:VERSION}}function barchartDoubleObject(e,o,t,n,r,a,u,i,l,s){var c=getIndices(e,t,n,r,a),p=uniqueCategories(o,c.category,c.order),d=uniqueDataInColumnMaintainOrder(o,c.secondary),f=[];return d.forEach(function(t){var n=_.filter(o,function(e){return e[c.secondary]===t}),r=[];_.forEach(p,function(e){r.push(valueForCategory(n,c.category,c.value,c.parent,e))}),f.push({name:t,data:r})}),{type:"bar",title:{text:u},xAxis:{title:{text:i},categories:p},yAxis:{title:{text:l}},series:sortChartSeries(f),number_format:s,version:VERSION}}function linechartObject(e,t,n,r,o,a,u,i){var l=_.clone(e),s=getIndices(l.shift(),t,n,null,null,"[None]"===i?null:i),c=uniqueDataInColumnMaintainOrder(l,s.category),p=uniqueDataInColumnMaintainOrder(l,s.secondary),d=s.secondary,f=s.custom;if(f){var m=_.map(p,function(t){var e=_.findIndex(l,function(e){return e[d]===t});return l[e][f]});p=_.map(_.sortBy(_.zip(p,m),function(e){return e[1]}),function(e){return e[0]})}var h=[];return _.forEach(p,function(t){var n=[];_.forEach(c,function(e){n.push(valueForCategoryAndSeries(l,s.category,e,s.secondary,t,s.value))}),h.push({name:t,data:n})}),{type:"line",title:{text:r},xAxis:{title:{text:o},categories:c},yAxis:{title:{text:a}},series:sortChartSeries(h),number_format:u,version:VERSION}}function componentChartObject(e,t,n,r,o,a,u,i,l){var s=_.clone(e),c=getIndices(s.shift(),t,n,null,i,l),p=null;p=isUndefinedOrNull(i)||"[None]"===i?uniqueDataInColumnMaintainOrder(s,c.category):uniqueDataInColumnOrdered(s,c.category,c.order);var d=(isUndefinedOrNull(l)||"[None]"===l?uniqueDataInColumnMaintainOrder(s,c.secondary).reverse():uniqueDataInColumnOrdered(s,c.secondary,c.custom).reverse()).map(function(t){var e=p.map(function(e){return valueForCategoryAndSeries(s,c.category,e,c.secondary,t,c.value)});return{name:t,data:e}});return{type:"component",title:{text:r},xAxis:{title:{text:o},categories:p},yAxis:{title:{text:a}},series:d,number_format:u,version:VERSION}}function panelBarchartObject(e,r,t,n,o,a,u,i,l){var s=_.clone(e),c=getIndices(s.shift(),r,t,null,i,l),p=uniqueCategories(s,c.category,c.order),d=(isUndefinedOrNull(l)||"[None]"===l?uniqueDataInColumnMaintainOrder(s,c.secondary):uniqueDataInColumnOrdered(s,c.secondary,c.custom)).map(function(t){var n=_.filter(s,function(e){return e[c.secondary]===t}),e=p.map(function(e){return valueForCategory(n,c.category,c.value,c.parent,e)});return{type:"small_bar",title:{text:t},xAxis:{title:{text:o},categories:p},yAxis:{title:{text:a}},series:[{name:r,data:e}],number_format:u}});return{type:"panel_bar_chart",title:{text:n},xAxis:{title:{text:o},categories:p},yAxis:{title:{text:a}},panels:d,version:VERSION}}function panelLinechartObject(e,t,n,r,o,a,u,i){var l=_.clone(e),s=getIndices(l.shift(),n,t,null,null,i),c=null;c=isUndefinedOrNull(i)||"[None]"===i?uniqueDataInColumnMaintainOrder(l,s.category):uniqueDataInColumnOrdered(l,s.category,s.custom);var p=uniqueDataInColumn(l,s.secondary);return{type:"panel_line_chart",title:{text:r},panels:_.map(c,function(t){var e=_.map(p,function(e){return valueForCategoryAndSeries(l,s.secondary,e,s.category,t,s.value)});return{type:"line",title:{text:t},xAxis:{title:{text:o},categories:p},yAxis:{title:{text:a}},series:[{name:t,data:e}],number_format:u}}),number_format:u,version:VERSION}}function getIndices(e,t,n,r,o,a){var u=_.map(e,function(e){return e.trim().toLowerCase()}),i=isUndefinedOrNull(t)?null:index_of_column_named(u,t),l=isUndefinedOrNull(o)?i:index_of_column_named(u,o),s=isUndefinedOrNull(r)?null:index_of_column_named(u,r),c=isUndefinedOrNull(n)?null:index_of_column_named(u,n),p=isUndefinedOrNull(a)?null:index_of_column_named(u,a);return{category:0<=i?i:null,order:0<=l?l:null,secondary:0<=c?c:null,value:index_of_column_named(u,"value"),parent:0<=s?s:null,custom:0<=p?p:null}}function uniqueCategories(e,t,n){return n?uniqueDataInColumnOrdered(e,t,n):uniqueDataInColumnMaintainOrder(e,t)}function valueForCategory(e,t,n,r,o){var a=e.filter(function(e){return e[t]===o});if(0===a.length)return{y:0,category:o};var u=a[0];if(u[t]===o){var i=isNumber(u[n]);if(r){var l=u[r],s={is_parent:l===o,is_child:l!==o,parent:l};return s.is_parent?{y:i?parseFloat(u[n]):0,relationships:s,category:u[t],color:defaultParentColor,text:i?"number":u[n]}:{y:i?parseFloat(u[n]):0,relationships:s,category:u[t],color:defaultChildColor,text:i?"number":u[n]}}return{y:i?parseFloat(u[n]):0,category:u[t],text:i?"number":u[n]}}}function valueForCategoryAndSeries(e,t,n,r,o,a){var u=_.filter(e,function(e){return e[t]===n&&e[r]===o});return 0<u.length?parseFloat(u[0][a]):0}function isNumber(e){return!isNaN(parseFloat(e))}function isUndefinedOrNull(e){return null==e}function sortChartSeries(e){return 0<e.filter(function(e){return isNaN(toNumberSortValue(e.name))}).length?e:(e.forEach(function(e){e.name_value=toNumberSortValue(e.name)}),_.sortBy(e,function(e){return e.name_value}))}function toNumberSortValue(e){var t=parseFloat(e);return isNaN(t)?parseFloat(e.substring(1)):t}if("undefined"!=typeof exports){_=require("../charts/vendor/underscore-min");var dataTools=require("../charts/rd-data-tools"),builderTools=require("../cms/rd-builder"),uniqueDataInColumnMaintainOrder=(index_of_column_named=dataTools.index_of_column_named,dataTools.uniqueDataInColumnMaintainOrder),getColumnIndex=builderTools.getColumnIndex;exports.barchartObject=barchartObject,exports.linechartObject=linechartObject,exports.componentChartObject=componentChartObject,exports.panelLinechartObject=panelLinechartObject,exports.panelBarchartObject=panelBarchartObject}var NONE_VALUE="[None]";function buildTableObject(e,t,n,r,o,a,u,i,l,s,c,p){return preProcessTableObject(u&&u!==NONE_VALUE?groupedTable(e,t,n,r,o,a,u,l,i,s,c,p):simpleTable(e,t,n,r,o,a,l,i,s,c))}function preProcessTableObject(e){return"simple"===e.type?preProcessSimpleTableObject(e):"grouped"===e.type&&preProcessGroupedTableObject(e),e}function simpleTable(e,t,n,r,o,a,u,i,l,s){var c=_.clone(e),p=c.shift(),d=_.map(p,function(e){return e.trim().toLowerCase()}),f=index_of_column_named(d,o),m=_.map(u,function(e){return index_of_column_named(d,e)}),h=f,v=!1;if(a&&a!==NONE_VALUE&&(h=index_of_column_named(d,a),v=!0),i&&i!==NONE_VALUE)var g=index_of_column_named(d,i);var b=_.map(c,function(t,e){var n={is_parent:!1,is_child:!1,parent:t[f]};if(v){var r=t[h],o=t[f];n={is_parent:r===o,is_child:r!==o,parent:r}}var a=_.map(m,function(e){return t[e]}),u=_.map(a,function(e){return numVal(e)});return g?{category:t[f],relationships:n,order:t[g],values:a,sort_values:u}:{category:t[f],relationships:n,order:e,values:a,sort_values:u}});return b=_.sortBy(b,function(e){return e.order}),v&&(b=adjustSimpleTableDataForParents(b)),{type:"simple",parent_child:v,header:t,subtitle:n,footer:r,category:o,columns:l,data:b,category_caption:null==s?o:s}}function preProcessSimpleTableObject(e){var t=columnDecimalPlaces(e),n=columnCouldBeAYear(e);e.data=_.map(e.data,function(e){return e.values=_.map(_.zip(e.values,t,n),function(e){return!1===e[2]?formatNumberWithDecimalPlaces(e[0],e[1]):e[0]}),e})}function columnDecimalPlaces(e){var t=[];for(var n in e.data[0].values){var r=_.map(e.data,function(e){return e.values[n]});t.push(seriesDecimalPlaces(r))}return t}function columnCouldBeAYear(e){var t=[];for(var n in e.data[0].values){var r=_.map(e.data,function(e){return e.values[n]});t.push(seriesCouldBeYear(r))}return t}function adjustSimpleTableDataForParents(e){return reorderSimpleTableDataForParentChild(addMissingSimpleTableParentItems(e))}function addMissingSimpleTableParentItems(o){var e=_.uniq(_.map(o,function(e){return e.relationships.parent})),t=_.map(o,function(e){return e.category}),n=_.filter(e,function(e){return!_.contains(t,e)}),a=_.clone(o),u=o[0];return _.forEach(n,function(t){var e=_.filter(o,function(e){return e.relationships.parent===t}),n=_.min(_.map(e,function(e){return e.order}))-1,r={category:t,order:n,relationships:{is_child:!1,is_parent:!0,parent:t},sort_values:_.map(u.sort_values,function(e){return 0}),values:_.map(u.values,function(e){return""})};a.push(r)}),a}function reorderSimpleTableDataForParentChild(n){var r=_.object(_.map(n,function(e){return[e.category,e]})),e=_.uniq(_.map(n,function(e){return e.relationships.parent})),o=[];return _.forEach(e,function(t){o.push(r[t]);var e=_.filter(n,function(e){return e.category!==t&&e.relationships.parent===t});o=o.concat(e)}),o}function groupedTable(e,t,n,r,o,a,u,i,l,s,c,p){var d=_.clone(e),f=d.shift(),m=_.map(f,function(e){return e.trim().toLowerCase()}),h=index_of_column_named(m,o),v=_.map(i,function(e){return index_of_column_named(m,e)}),g=index_of_column_named(m,u),b=-2;null===l?b=h:l!==NONE_VALUE&&(b=index_of_column_named(m,l));var y=h,O=!1;a&&a!==NONE_VALUE&&(y=index_of_column_named(m,a),O=!0);var C=buildDataObjectsByGroup(getDataByGroup(d,g,p,f),d,g,h,O,y,b,-2,v),E=templateGroupTable(o,t,s,C=adjustGroupedTableDataForParents(C)),T=[""].concat(_.map(E.groups,function(e){return e.group})),A=_.map(E.groups[0].data,function(e){return e.category}),x=_.map(A,function(e){return dataItemWithCategory(E,e)});return{group_columns:T,type:"grouped",category:o,group_column:u,columns:s,data:x=_.sortBy(x,function(e){return e.order}),header:t,subtitle:n,footer:r,groups:C=_.map(C,function(e){return e.data=_.sortBy(e.data,function(e){return e.order}),e}),parent_child:O,category_caption:null==c?o:c}}function preProcessGroupedTableObject(e){var o=groupedTableDecimalPlaces(e),a=groupedTableCouldBeAYear(e);for(var t in e.groups=_.map(e.groups,function(e){return e.data=_.map(e.data,function(e){return e.values=_.map(_.zip(e.values,o,a),function(e){return!1===e[2]?formatNumberWithDecimalPlaces(e[0],e[1]):e[0]}),e}),e}),e.data=[],e.groups[0].data){var n=_.clone(e.groups[0].data[t]);n.values=_.flatten(_.map(e.groups,function(e){return e.data[t].values})),n.sort_values=_.flatten(_.map(e.groups,function(e){return e.data[t].sort_values})),e.data.push(n)}var r=_.sortBy(e.groups[0].data,function(e){return e.order}),u=_.map(r,function(e){return e.category});_.forEach(u,function(n){var r="<tr><th>"+n+"</th>";_.forEach(e.groups,function(e){var t=_.findWhere(e.data,{category:n});_.forEach(_.zip(t.values,o,a),function(e){r=e[2]?r+"<td>"+e[0]+"</td>":r+"<td>"+formatNumberWithDecimalPlaces(e[0],e[1])+"</td>"})})})}function groupedTableDecimalPlaces(e){var t=[];for(var n in e.groups[0].data[0].values){var r=_.flatten(_.map(e.groups,function(e){return _.map(e.data,function(e){return e.values[n]})}));t.push(seriesDecimalPlaces(r))}return t}function groupedTableCouldBeAYear(e){var t=[];for(var n in e.groups[0].data[0].values){var r=_.flatten(_.map(e.groups,function(e){return _.map(e.data,function(e){return e.values[n]})}));t.push(seriesCouldBeYear(r))}return t}function buildDataObjectsByGroup(e,r,o,l,s,c,p,d,f){return _.map(e,function(t){var e=_.filter(r,function(e){return e[o]===t}),n=_.map(e,function(t,e){var n={is_parent:!1,is_child:!1,parent:t[l]};if(s){var r=t[c],o=t[l];n={is_parent:r===o,is_child:r!==o,parent:r}}var a=p===d?e:t[p],u=_.map(f,function(e){return t[e]}),i=_.map(u,function(e){return numVal(e)});return{category:t[l],relationships:n,order:a,values:u,sort_values:i}});return{group:t,data:n}})}function getDataByGroup(n,r,e,t){var o=uniqueDataInColumnMaintainOrder(n,r);if(e&&e!==NONE_VALUE){var a=t.indexOf(e),u=_.map(o,function(t){var e=_.findIndex(n,function(e){return e[r]===t});return n[e][a]});o=_.map(_.sortBy(_.zip(o,u),function(e){return e[1]}),function(e){return e[0]})}return o}function dataItemWithCategory(e,n){var r=[],o="",a="",u={};_.forEach(e.groups,function(e){var t=_.findWhere(e.data,{category:n});o=t.order,a=t.parent,u=t.relationships,_.forEach(t.values,function(e){r.push(e)})});var t=_.map(r,function(e){return numVal(e)});return{category:n,relationships:u,parent:a,order:o,values:r,sort_values:t}}function templateGroupTable(e,t,n,r){return{type:"grouped",category:e,title:{text:"Grouped Table"},header:t,columns:n,groups:r}}function adjustGroupedTableDataForParents(e){return reorderGroupedTableDataForParentChild(addMissingGroupedTableParentItems(e))}function addMissingGroupedTableParentItems(t){var e=_.uniq(_.flatten(_.map(t,function(e){return _.map(e.data,function(e){return e.relationships.parent})}))),n=_.uniq(_.flatten(_.map(t,function(e){return _.map(e.data,function(e){return e.category})}))),r=_.filter(e,function(e){return!_.contains(n,e)}),o=_.clone(t),a=t[0].data[0];return _.forEach(r,function(n){var e=_.filter(_.flatten(_.map(t,function(e){return e.data})),function(e){return e.relationships.parent===n}),r=_.min(_.map(e,function(e){return e.order}))-1;_.forEach(o,function(e){var t={category:n,order:r,relationships:{is_child:!1,is_parent:!0,parent:n},sort_values:_.map(a.sort_values,function(e){return 0}),values:_.map(a.values,function(e){return""})};e.data.push(t)})}),o}function reorderGroupedTableDataForParentChild(e){_.object(_.map(e,function(e){return[e.category,e]}));var t=_.uniq(_.flatten(_.map(e,function(e){return _.map(e.data,function(e){return e.relationships.parent})})));return _.forEach(e,function(n){var r=_.object(_.map(n.data,function(e){return[e.category,e]})),o=[];_.forEach(t,function(t){o.push(r[t]);var e=_.filter(n.data,function(e){return e.category!==t&&e.relationships.parent===t});o=o.concat(e)}),n.data=o}),e}function preProcessGroupedTableObject(e){var o=groupedTableDecimalPlaces(e),a=groupedTableCouldBeAYear(e);for(var t in e.groups=_.map(e.groups,function(e){return e.data=_.map(e.data,function(e){return e.values=_.map(_.zip(e.values,o,a),function(e){return!1===e[2]?formatNumberWithDecimalPlaces(e[0],e[1]):e[0]}),e}),e}),e.data=[],e.groups[0].data){var n=_.clone(e.groups[0].data[t]);n.values=_.flatten(_.map(e.groups,function(e){return e.data[t].values})),n.sort_values=_.flatten(_.map(e.groups,function(e){return e.data[t].sort_values})),e.data.push(n)}var r=_.sortBy(e.groups[0].data,function(e){return e.order}),u=_.map(r,function(e){return e.category});_.forEach(u,function(n){var r="<tr><th>"+n+"</th>";_.forEach(e.groups,function(e){var t=_.findWhere(e.data,{category:n});_.forEach(_.zip(t.values,o,a),function(e){r=e[2]?r+"<td>"+e[0]+"</td>":r+"<td>"+formatNumberWithDecimalPlaces(e[0],e[1])+"</td>"})})})}function numVal(e,t){var n=String(e).replace(/\,/g,""),r=Number(n);return r||e}if("undefined"!=typeof exports){_=require("../charts/vendor/underscore-min"),dataTools=require("../charts/rd-data-tools"),builderTools=require("../cms/rd-builder"),uniqueDataInColumnMaintainOrder=dataTools.uniqueDataInColumnMaintainOrder;var seriesDecimalPlaces=dataTools.seriesDecimalPlaces,seriesCouldBeYear=dataTools.seriesCouldBeYear,formatNumberWithDecimalPlaces=dataTools.formatNumberWithDecimalPlaces;getColumnIndex=builderTools.getColumnIndex,index_of_column_named=dataTools.index_of_column_named;exports.buildTableObject=buildTableObject,exports.simpleTable=simpleTable,exports.groupedTable=groupedTable}function drawTable(e,t){return preProcessTableObject(t),"simple"===t.type?simpleHtmlTable(e,t):"grouped"===t.type?groupedHtmlTable(e,t):void 0}function simpleHtmlTable(e,t){var n="";return n=appendSimpleTableBody(n=appendSimpleTableHeader(n+="<table class='table table-sm'>",t),t),n+="</table>",$("#"+e).html(n),!0}function appendSimpleTableHeader(e,t){var n="";return n=null==t.category_caption?"<thead><tr><th></th>":"<thead><tr><th>"+t.category_caption+"</th>",_.forEach(t.columns,function(e){n=n+"<th>"+e+"</th>"}),e+(n+="</tr></thead>")}function appendSimpleTableBody(e,t){var n="<tbody>";return _.forEach(t.data,function(e){n+="<tr>",t.parent_child?e.relationships.is_parent?n+='<th class="parent_row">':n+='<th class="child_row">':n+="<th>",n=n+e.category+"</th>",_.forEach(e.values,function(e){n=n+"<td>"+e+"</td>"}),n+="</tr>"}),e+(n+="</tbody>")}function groupedHtmlTable(e,t){var n="";return n=appendGroupedTableBody(n=appendGroupTableHeader(n+="<table class='table table-sm'>",t),t),n=insertTableFooter(n+="</table>",t),$("#"+e).html(n),!0}function appendGroupedTableBody(e,t){var o="<tbody>",n=_.sortBy(t.groups[0].data,function(e){return e.order});return _.forEach(n,function(e){var n=e.category,r="<tr>";t.parent_child?e.relationships.is_parent?r+='<th class="parent_row">':r+='<th class="child_row">':r+="<th>",r=r+n+"</th>",_.forEach(t.groups,function(e){var t=_.findWhere(e.data,{category:n});_.forEach(t.values,function(e){r=r+"<td>"+e+"</td>"})}),o+=r+="</tr>"}),e+(o+="</tbody>")}function appendGroupTableHeader(e,t){var n="";n=null==t.category_caption?"<thead><tr><th></th>":"<thead><tr><th>"+t.category_caption+"</th>",_.forEach(t.groups,function(e){n+=multicell(e.group,t.columns.length)}),n+="</tr>";var r=!1;return _.forEach(t.columns,function(e){""!==e&&(r=!0)}),r&&(n+="<tr><td></td>",_.forEach(t.groups,function(e){_.forEach(t.columns,function(e){n=n+"<td>"+e+"</td>"})}),n+="</tr>"),e+(n+="</thead>")}function appendTableTitle(e,t){return t.header&&""!==t.header?e+"<div class='table-title heading-small'>"+t.header+"</div>":e}function appendTableSubtitle(e,t){return t.subtitle&&""!==t.subtitle?e+"<div class='table-subtitle'>"+t.subtitle+"</div>":e}function insertTableFooter(e,t){return t.footer&&""!==t.footer?e+"<div class='table-footer'>"+t.footer+"</div>":e}function multicell(e,t){return"<td colspan="+t+">"+e+"</td>"}$(document).ready(function(){var e=$(".sticky-js");$.each(e,function(){var t=parseInt($(this).position().top);$(window).scroll(function(){var e=$(window).scrollTop();t<=e?$(this).addClass("sticky-js-fixed"):$(this).removeClass("sticky-js-fixed")}.bind(this))})});
//# sourceMappingURL=cms.js.map
