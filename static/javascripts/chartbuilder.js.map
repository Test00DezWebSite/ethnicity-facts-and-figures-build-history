{"version":3,"sources":["chartbuilder.js"],"names":["classifications","chart_data","current_data","current_settings","getNumberFormat","format","$","val","multiplier","prefix","suffix","min","max","getTips","basicErrors","validateChart","length","missingFields","checkRequiredFields","ethnicityColumn","getEthnicityColumnHeader","secondaryColumn","getSecondaryColumnHeader","validateData","document","ready","handleNewData","on_success","tabbedData","textToData","message","getElementById","innerHTML","headers","listWithNone","dropdownHtmlWithDefault","listWithRequired","populateChartOptions","ethnicity_data","getEthnicityValues","ajax","type","url","url_get_classifications","dataType","data","JSON","stringify","contentType","success","response","html","c","classification_name","classification_id","populateEthnicityClassifications","showHideCustomEthnicityPanel","classList","remove","failure","console","log","error","err","all_data","_","clone","column","index","toLowerCase","trim","indexOf","getEthnicityColumn","shift","pluck","add","defaultValue","stripped","exclude","h","header","push","strippedHeaders","preview","evt","hideErrors","tips","tip_list","i","children","tipsOfType","ETHNICITY_ERROR","VALUE_ERROR","RECTANGLE_ERROR","DATA_ERROR_COMPLEX_DATA","DATA_ERROR_DUPLICATION","DATA_ERROR_MISSING_DATA","MISSING_FIELD_ERROR","href","field","el","closest","displayTips","chartObject","buildChartObject","title","drawChart","dispatchEvent","Event","displayChart","errorType","filter","tip","getChartPageSettings","chartType","preset","getClassificationCode","custom","getCustomObject","chartOptions","x_axis_column","dataStyle","data_style","bar_column","group_column","bar_order","section_column","section_order","panel_column","panel_order","getChartTypeOptions","chartFormat","chart_title","x_axis_label","y_axis_label","number_format","number_format_prefix","number_format_suffix","number_format_min","number_format_max","getCustomClassificationCode","code","hasParents","prop","hasAll","hasUnknown","chart_type","classification","id","getClassificationById","barchartObject","buildDataWithClassifications","linechartObject","barColumn","groupColumn","sectionColumn","sectionOrder","componentChartObject","groupOrder","panelColumn","panelOrder","panelBarchartObject","panelBarColumn","panelBarOrder","panel_x_axis_column","panelLinechartObject","columns","rows","concat","body","lowHeaders","map","indices","col","lowCol","r","item","row","selectChartType","chartOptionGroupDivs","getElementsByClassName","selectCustomValues","customObject","customClassification","selectCustomClassification","customValue","selectCustomHasParents","selectCustomHasAll","selectCustomHasUnknown","setupChartbuilderWithSettings","settings","selectClassification","columnValue","addEventListener","data_text_area","data_error_message","data_form_group","value","textContent","attr","chartBuilderSettings","src","each","series","this","isNaN","y","url_save_chart_to_page","source","classificationCode","customClassificationCode","ethnicityValues","scrollIntoView","location","reload","postChartObject","change","data_text","d","join","initialiseForm","search","pasteJson","json","addClass","removeClass"],"mappings":"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","file":"chartbuilder.js","sourcesContent":["\n/*\n    Functionality of chartbuilder including the main methods that run each stage\n\n\n    On open **initialiseForm()**\n    - grab current_settings from dimension.chart_settings_and_source_data if such a thing exists\n    - if current_settings doesn't exist open with the data area open.\n    - otherwise set the current_settings from file, paste data into the data panel and run the On new data routine below\n\n    On new data (changing data in the data panel area and clicking OK) **handleNewData()**\n    - use an AJAX call to the /get-valid-classifications-for-data endpoint to add extra values **buildDataWithClassifications()**\n    - populate the chart builder dropdowns with correct values **populateChartOptions(), populateEthnicityClassifications()**\n    - if any settings currently exist apply as many as are still relevant **setupChartbuilderWithSettings()**\n\n    On settings changes\n    - validate they will make a viable chart **getTips()**\n    - if so use the rd chart object factory and renderer to display a preview **preview()**\n    - otherwise display an error and tip to fix it **displayTips()**\n\n    On save\n    - build a chart object with the rd-chart-object factory **buildChartObject()**\n    - create a chart_settings lump of json **getChartPageSettings()**\n    - post both to <dimension>/create-chart endpoint **postChartObject()**\n */\n\n// The main working data variables\nvar classifications = [];\nvar chart_data = null;\n\n// Variables that needs to be maintained when the user makes changes to the text data\nvar current_data = \"\";\nvar current_settings = null;\n\n$(document).ready(function () {\n\n    // add events to buttons\n    document.getElementById('confirm-data').addEventListener('click', setChartData)\n    document.getElementById('edit-data').addEventListener('click', editChartData)\n    document.getElementById('cancel-edit-data').addEventListener('click', cancelEditData)\n    document.getElementById('save').addEventListener('click', saveChart)\n\n    /*\n    Events from the DATA ENTRY PANEL\n    */\n    function setChartData(evt) {\n\n        var data_text_area = document.getElementById('data_text_area')\n        var data_error_message = document.getElementById('data-error')\n        var data_form_group = document.getElementById('data-form-group')\n\n        if (data_text_area.value != '') {\n\n            handleNewData(function () {\n                if (current_settings) {\n                    setupChartbuilderWithSettings(current_settings)\n                }\n                preview()\n            });\n            document.getElementById('data-panel').classList.add('hidden')\n            document.getElementById('edit-panel').classList.remove('hidden')\n            document.getElementById('builder-title').textContent = 'Format and view chart'\n            document.title = 'Format and view chart'\n\n            data_text_area.classList.remove('govuk-textarea--error')\n            data_form_group.classList.remove('govuk-form-group--error')\n            data_error_message.textContent = ''\n\n        } else {\n            data_text_area.classList.add('govuk-textarea--error')\n            data_form_group.classList.add('govuk-form-group--error')\n            data_error_message.textContent = 'Enter some data';\n            data_error_message.classList.remove('hidden');\n            document.getElementById('errors_container').classList.remove('hidden');\n            document.getElementById('data-missing').classList.remove('hidden');\n        }\n\n\n    }\n\n    function editChartData(evt) {\n        hideErrors()\n        current_data = $('#data_text_area').val();\n        current_settings = getChartPageSettings();\n        document.getElementById('data-panel').classList.remove('hidden')\n        document.getElementById('edit-panel').classList.add('hidden')\n        document.getElementById('builder-title').textContent = 'Create a chart'\n        document.title = 'Create a chart'\n    }\n\n    function cancelEditData(evt) {\n        $('#data_text_area').val(current_data);\n        document.getElementById('data-panel').classList.add('hidden')\n        document.getElementById('edit-panel').classList.remove('hidden')\n        document.getElementById('builder-title').textContent = 'Format and view chart'\n        document.title = 'Format and view chart'\n        document.getElementById('errors_container').classList.add('hidden');\n        document.getElementById('data-missing').classList.add('hidden');\n    }\n\n\n    /*\n    Initialise the main editor after DATA ENTRY PANEL change\n    */\n\n    function handleNewData(on_success) {\n        // get the data\n        var tabbedData = $(\"#data_text_area\").val();\n\n        // set the DATA DISPLAY content\n        chart_data = textToData(tabbedData);\n        if (chart_data.length > 0) {\n            message = chart_data.length - 1 + ' rows by ' + chart_data[0].length + ' columns'\n        }\n\n        document.getElementById('data-description').innerHTML = message;\n\n        // update options in drop-downs\n        var headers = chart_data[0];\n        populateChartOptions(headers);\n\n        // call the backend to do the presets heavy lifting\n        var ethnicity_data = getEthnicityValues(chart_data);\n        $.ajax({\n            type: \"post\",\n            url: url_get_classifications,\n            dataType: 'json',\n            data: JSON.stringify({ 'data': ethnicity_data }),\n            contentType: 'application/json; charset=utf-8',\n            success: function (response) {\n                // upon heavy lifting complete\n\n                // populate the ethnicity presets from the response\n                classifications = response['classifications'];\n                populateEthnicityClassifications(classifications);\n                showHideCustomEthnicityPanel();\n\n                // show the presets (step 2) and chart type (step 3) section\n                document.getElementById('ethnicity_settings_section').classList.remove('hidden')\n                document.getElementById('select_chart_type').classList.remove('hidden')\n\n\n                // any further processing\n                if (on_success) {\n                    on_success();\n                }\n            },\n            failure: function () {\n                console.log('failed to get ethnicity classifcations');\n            },\n            error: function (err) {\n                console.log(err);\n            }\n        });\n    }\n\n    function getEthnicityValues(data) {\n        var all_data = _.clone(data);\n        var headers = all_data.shift();\n\n        var column = getEthnicityColumn(headers);\n        if (column >= 0) {\n            return _.pluck(all_data, column);\n        }\n        return [];\n    }\n\n    function getEthnicityColumn(headers) {\n        for (var index = 0; index < headers.length; index++) {\n            var cleanHeader = headers[index].toLowerCase().trim();\n            if (cleanHeader.indexOf('ethnic') >= 0) {\n                return index\n            }\n        }\n        return -1;\n    }\n\n    /*\n    SETUP\n    */\n\n    function populateChartOptions(headers) {\n        var listWithNone = dropdownHtmlWithDefault(headers, '[None]');\n        var listWithRequired = dropdownHtmlWithDefault(headers, 'Please select');\n\n        document.getElementById('line__x-axis_column').innerHTML = listWithRequired\n\n        document.getElementById('grouped-bar__bar_column').innerHTML = listWithRequired\n        document.getElementById('grouped-bar__groups_column').innerHTML = listWithRequired\n\n        document.getElementById('component__bar_column').innerHTML = listWithRequired\n        document.getElementById('component__bar_order').innerHTML = listWithNone\n        document.getElementById('component__section_column').innerHTML = listWithRequired\n        document.getElementById('component__section_order').innerHTML = listWithNone\n\n        document.getElementById('panel-bar__panel_column').innerHTML = listWithRequired\n        document.getElementById('panel-bar__panel_order').innerHTML = listWithNone\n        document.getElementById('panel-bar__bar_column').innerHTML = listWithRequired\n        document.getElementById('panel-bar__bar_order').innerHTML = listWithNone\n\n        document.getElementById('panel-line__x-axis_column').innerHTML = listWithRequired\n    }\n\n    function selectDropdown(dropdown_id, value) {\n        var dropdown = document.getElementById(dropdown_id);\n        for (var i = 0; i < dropdown.length; i++) {\n            dropdown[i].selected = (dropdown[i].value === value)\n        }\n    }\n\n\n    function showHideCustomEthnicityPanel() {\n        if($('#ethnicity_settings').val() === 'custom') {\n            document.getElementById('custom_classification__panel').classList.remove('hidden')\n        } else {\n            document.getElementById('custom_classification__panel').classList.add('hidden')\n        }\n    }\n\n    function populateEthnicityClassifications(classifications) {\n        var html = '';\n        for (var c in classifications) {\n            var classification_name = classifications[c]['classification']['name'];\n            var classification_id = classifications[c]['classification']['id'];\n            if (c === 0) {\n                html = html + '<option value=\"' + classification_id + '\" selected>' + classification_name + '</option>';\n            } else {\n                html = html + '<option value=\"' + classification_id + '\" >' + classification_name + '</option>';\n            }\n        }\n        document.getElementById('ethnicity_settings').innerHTML = html\n    }\n\n    function strippedHeaders(headers) {\n        var exclude = ['Measure', 'Ethnicity', 'Ethnic group', 'Value', 'Values'];\n        var stripped = [];\n        for (h in headers) {\n            var header = headers[h];\n            if (exclude.indexOf(header) < 0) {\n                stripped.push(header);\n            }\n        }\n        return stripped;\n    }\n\n    function dropdownHtmlWithDefault(headers, defaultValue) {\n        var html = '<option value=\"' + defaultValue + '\" selected>' + defaultValue + '</option>';\n        var stripped = strippedHeaders(headers);\n        for (var h in stripped) {\n            var header = stripped[h];\n            html = html + '<option value=\"' + header + '\">' + header + '</option>';\n        }\n        return html;\n    }\n\n    /*\n    PREVIEW\n    Render the chart as a preview using drawChart() from rd - graph.js (this the exact same method that is used front - end)\n    */\n\n    function preview(evt) {\n        hideErrors()\n        var tips = getTips();\n        if (tips.length > 0) {\n            displayTips(tips);\n        } else {\n            displayChart();\n        }\n    }\n\n    function displayTips(tips) {\n        document.getElementById('preview_container').classList.add('hidden')\n        document.getElementById('errors_container').classList.remove('hidden')\n\n        var tip_list = document.getElementById('tip-list')\n        for (var i = 0; i < tip_list.children.length; i++) {\n            tip_list.children[i].classList.add('hidden')\n        }\n\n        if (tipsOfType(tips, ETHNICITY_ERROR).length > 0) {\n            document.getElementById('tip__ethnicity-column').classList.remove('hidden')\n            document.getElementById('tab_seperated_content').classList.add('govuk-form-group--error')\n            document.getElementById('edit-data-error').classList.remove('hidden')\n        }\n        if (tipsOfType(tips, VALUE_ERROR).length > 0) {\n            document.getElementById('tip__value-column').classList.remove('hidden')\n            document.getElementById('tab_seperated_content').classList.add('govuk-form-group--error')\n            document.getElementById('edit-data-error').classList.remove('hidden')\n        }\n        if (tipsOfType(tips, RECTANGLE_ERROR).length > 0) {\n            document.getElementById('tip__rectangular-data').classList.remove('hidden')\n            document.getElementById('tab_seperated_content').classList.add('govuk-form-group--error')\n            document.getElementById('edit-data-error').classList.remove('hidden')\n        }\n        if (tipsOfType(tips, DATA_ERROR_COMPLEX_DATA).length > 0) {\n            document.getElementById('tip__complex-data').classList.remove('hidden')\n            document.getElementById('select_chart_type').classList.add('govuk-form-group--error')\n            document.getElementById('chart_type_selector-error').classList.remove('hidden')\n        }\n        if (tipsOfType(tips, DATA_ERROR_DUPLICATION).length > 0) {\n            document.getElementById('tip__duplicate-data').classList.remove('hidden')\n            document.getElementById('tab_seperated_content').classList.add('govuk-form-group--error')\n            document.getElementById('edit-data-error').classList.remove('hidden')\n        }\n        if (tipsOfType(tips, DATA_ERROR_MISSING_DATA).length > 0) {\n            document.getElementById('tip__missing-data').classList.remove('hidden')\n        }\n        // if (tipsOfType(tips, MISSING_FIELD_ERROR).length > 0) {\n        //     document.getElementById('notes_container').classList.remove('hidden')\n        // }\n        if (tipsOfType(tips, MISSING_FIELD_ERROR).length > 0) {\n            document.getElementById('tip__required-settings').classList.remove('hidden')\n            document.getElementById(\"settings-error-anchor-link\").href = \"#\" + tips[0].field + \"-error\";\n            var el = document.getElementById(tips[0].field + \"-error\")\n            if (el) {\n                el.classList.remove('hidden')\n                el.closest(\".chart-builder-section\").classList.add('govuk-form-group--error')\n            }\n        }\n\n    }\n\n    function tipsOfType(tips, errorType) {\n        return _.filter(tips, function (tip) {\n            return tip.errorType === errorType;\n        })\n    }\n\n    function displayChart() {\n        document.getElementById('preview_container').classList.remove('hidden')\n\n        var chartObject = buildChartObject();\n        if (chartObject) {\n            chartObject.title = '';\n            drawChart('container', chartObject);\n\n            document.getElementById('save_section').classList.remove('hidden')\n        }\n\n        document.getElementById('chart_title').dispatchEvent(new Event(\"input\"));\n    }\n\n    /*\n    SAVE\n    Save the chart by building a chartObject and bundling up all the setting then sending it to the backend\n    */\n\n    function saveChart(evt) {\n\n        $('#save').attr('disabled', 'disabled');\n\n        var chartObject = buildChartObject();\n        var chartBuilderSettings = getChartPageSettings();\n        if (chartObject) {\n            postChartObject(chartObject, chartBuilderSettings);\n        }\n    }\n\n    function postChartObject(chartObject, src) {\n        if (chartObject) {\n            // adjust for null data\n            $.each(chartObject.series, function () {\n                for (var i = 0; i < this.data.length; i++) {\n                    if (isNaN(this.data[i].y)) {\n                        this.data[i].y = 0;\n                    }\n                }\n            });\n\n            $.ajax({\n                type: \"POST\",\n                url: url_save_chart_to_page,\n                dataType: 'json',\n                data: JSON.stringify({\n                    'chartObject': chartObject,\n                    'source': src,\n                    'classificationCode': getClassificationCode(),\n                    'customClassificationCode': getCustomClassificationCode(),\n                    'customClassification': getCustomObject(),\n                    'ethnicityValues': getEthnicityValues(chart_data)}),\n                contentType: 'application/json',\n                success: function () {\n                    document.getElementById(\"breadcrumb\").scrollIntoView();\n                    location.reload();\n                }\n            });\n        }\n    }\n\n    function getChartPageSettings() {\n        // get the data\n        var tabbedData = $(\"#data_text_area\").val();\n        var chartType = $('#chart_type_selector').val();\n        return {\n            'data': textToData(tabbedData),\n            'type': chartType,\n            'preset': getClassificationCode(),\n            'custom': getCustomObject(),\n            'chartOptions': getChartTypeOptions(chartType),\n            'chartFormat': getChartFormat(),\n        }\n    }\n\n    function getChartTypeOptions(chartType) {\n        switch (chartType) {\n            case 'bar_chart':\n                return {};\n            case 'line_graph':\n                return { 'x_axis_column': $('#line__x-axis_column').val() };\n            case 'grouped_bar_chart':\n                var dataStyle = $('#grouped-bar__data_style').val();\n                if (dataStyle === 'ethnicity_as_group') {\n                    return { 'data_style': dataStyle, 'bar_column': $('#grouped-bar__bar_column').val() }\n                } else {\n                    return { 'data_style': dataStyle, 'group_column': $('#grouped-bar__groups_column').val() }\n                }\n            case 'component_chart':\n                var dataStyle = $('#component__data_style').val();\n                if (dataStyle === 'ethnicity_as_sections') {\n                    return {\n                        'data_style': dataStyle, 'bar_column': $('#component__bar_column').val(),\n                        'bar_order': $('#component__bar_order').val()\n                    }\n                } else {\n                    return {\n                        'data_style': dataStyle, 'section_column': $('#component__section_column').val(),\n                        'section_order': $('#component__section_order').val()\n                    }\n                }\n            case 'panel_bar_chart':\n                var dataStyle = $('#panel-bar__data_style').val();\n                if (dataStyle === 'ethnicity_as_panels') {\n                    return {\n                        'data_style': dataStyle, 'bar_column': $('#panel-bar__bar_column').val(),\n                        'bar_order': $('#panel-bar__bar_order').val()\n                    }\n                } else {\n                    return {\n                        'data_style': dataStyle, 'panel_column': $('#panel-bar__panel_column').val(),\n                        'panel_order': $('#panel-bar__panel_order').val()\n                    }\n                }\n            case 'panel_line_chart':\n                return { 'x_axis_column': $('#panel-line__x-axis_column').val() };\n            default:\n                return {};\n        }\n    }\n\n    function getChartFormat() {\n        return {\n            'chart_title': $('#chart_title').val(),\n            'x_axis_label': $('#x_axis_label').val(),\n            'y_axis_label': $('#y_axis_label').val(),\n            'number_format': $('#number_format').val(),\n            'number_format_prefix': $('#number_format_prefix').val(),\n            'number_format_suffix': $('#number_format_suffix').val(),\n            'number_format_min': $('#number_format_min').val(),\n            'number_format_max': $('#number_format_max').val()\n        }\n    }\n\n    function getClassificationCode() {\n        return $('#ethnicity_settings').val();\n    }\n\n    function getCustomClassificationCode() {\n        return $('#custom_classification__selector').val();\n    }\n\n    function getCustomHasParents() {\n        return $('#custom_classification__has_parents').prop('checked');\n    }\n\n    function getCustomHasAll() {\n        return $('#custom_classification__has_all').prop('checked');\n    }\n\n    function getCustomHasUnknown() {\n        return $('#custom_classification__has_unknown').prop('checked');\n    }\n\n    function getCustomObject() {\n        return {\n            'code': getCustomClassificationCode(),\n            'hasParents': getCustomHasParents(),\n            'hasAll': getCustomHasAll(),\n            'hasUnknown': getCustomHasUnknown()\n        }\n    }\n\n    function buildChartObject() {\n        var chart_type = $('#chart_type_selector').val();\n        var chartObject = null;\n        var classification = getClassificationById($('#ethnicity_settings').val());\n        if (chart_type === 'bar_chart') {\n            chartObject = barchartObject(buildDataWithClassifications(classification, chart_data, ['value']),\n                'Ethnicity',\n                '[None]',\n                'Ethnicity-parent',\n                'Ethnicity-order',\n                $('#chart_title').val(),\n                $('#x_axis_label').val(),\n                $('#y_axis_label').val(),\n                getNumberFormat());\n        } else if (chart_type === 'line_graph') {\n            var x_axis_column = $('#line__x-axis_column').val();\n            chartObject = linechartObject(buildDataWithClassifications(classification, chart_data, ['value', x_axis_column]),\n                x_axis_column,\n                'Ethnicity',\n                $('#chart_title').val(),\n                $('#x_axis_label').val(),\n                $('#y_axis_label').val(),\n                getNumberFormat(),\n                'Ethnicity-order');\n        } else if (chart_type === 'grouped_bar_chart') {\n            if ($('#grouped-bar__data_style').val() === 'ethnicity_as_group') {\n                var barColumn = $('#grouped-bar__bar_column').val();\n                chartObject = barchartObject(buildDataWithClassifications(classification, chart_data, ['value', barColumn]),\n                    'Ethnicity',\n                    barColumn,\n                    '[None]',\n                    'Ethnicity-order',\n                    $('#chart_title').val(),\n                    $('#x_axis_label').val(),\n                    $('#y_axis_label').val(),\n                    getNumberFormat());\n            } else {\n                var groupColumn = $('#grouped-bar__groups_column').val();\n                chartObject = barchartObject(buildDataWithClassifications(classification, chart_data, ['value', groupColumn]),\n                    groupColumn,\n                    'Ethnicity',\n                    '[None]',\n                    'Ethnicity-order',\n                    $('#chart_title').val(),\n                    $('#x_axis_label').val(),\n                    $('#y_axis_label').val(),\n                    getNumberFormat());\n            }\n        } else if (chart_type === 'component_chart') {\n            if ($('#component__data_style').val() === 'ethnicity_as_bar') {\n                var sectionColumn = $('#component__section_column').val();\n                var sectionOrder = $('#component__section_order').val();\n                var data = [];\n                if (sectionOrder && sectionOrder !== '[None]') {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', sectionColumn, sectionOrder])\n                } else {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', sectionColumn])\n                }\n                chartObject = componentChartObject(data,\n                    'Ethnicity',\n                    sectionColumn,\n                    $('#chart_title').val(),\n                    $('#x_axis_label').val(),\n                    $('#y_axis_label').val(),\n                    getNumberFormat(),\n                    'Ethnicity-order',\n                    sectionOrder)\n            } else {\n                var groupColumn = $('#component__bar_column').val();\n                var groupOrder = $('#component__bar_order').val();\n                var data = [];\n                if (groupOrder && groupOrder !== '[None]') {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', groupColumn, groupOrder])\n                } else {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', groupColumn])\n                }\n                chartObject = componentChartObject(buildDataWithClassifications(classification, chart_data, ['value', groupColumn]),\n                    groupColumn,\n                    'Ethnicity',\n                    $('#chart_title').val(),\n                    $('#x_axis_label').val(),\n                    $('#y_axis_label').val(),\n                    getNumberFormat(),\n                    groupOrder,\n                    'Ethnicity-order')\n            }\n        } else if (chart_type === 'panel_bar_chart') {\n            if ($('#panel-bar__data_style').val() === 'ethnicity_as_panel_bars') {\n                var panelColumn = $('#panel-bar__panel_column').val();\n                var panelOrder = $('#panel-bar__panel_order').val();\n                var data = [];\n                if (panelOrder && panelOrder !== '[None]') {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', panelColumn, panelOrder])\n                } else {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', panelColumn])\n                }\n                chartObject = panelBarchartObject(data,\n                    'Ethnicity',\n                    panelColumn,\n                    $('#chart_title').val(),\n                    '',\n                    '',\n                    getNumberFormat(),\n                    'Ethnicity-order',\n                    panelOrder)\n            } else {\n                var panelBarColumn = $('#panel-bar__bar_column').val();\n                var panelBarOrder = $('#panel-bar__bar_order').val();\n                var data = [];\n                if (panelBarColumn && panelBarOrder !== '[None]') {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', panelBarColumn, panelBarOrder])\n                } else {\n                    data = buildDataWithClassifications(classification, chart_data, ['value', panelBarColumn])\n                }\n                chartObject = panelBarchartObject(data,\n                    panelBarColumn,\n                    'Ethnicity',\n                    $('#chart_title').val(),\n                    '',\n                    '',\n                    getNumberFormat(),\n                    panelBarOrder,\n                    'Ethnicity-order')\n            }\n        } else if (chart_type === 'panel_line_chart') {\n            var panel_x_axis_column = $('#panel-line__x-axis_column').val();\n            var data = buildDataWithClassifications(classification, chart_data, ['value', panel_x_axis_column]);\n            chartObject = panelLinechartObject(data,\n                panel_x_axis_column,\n                'Ethnicity',\n                $('#chart_title').val(),\n                '',\n                '',\n                getNumberFormat(),\n                'Ethnicity-order');\n        }\n        return chartObject;\n    }\n\n    function buildDataWithClassifications(classification, data, columns) {\n        var rows = [['Ethnicity', 'Ethnicity-parent', 'Ethnicity-order'].concat(columns)];\n\n        var body = _.clone(data);\n        var headers = body.shift();\n        var lowHeaders = _.map(headers, function (header) {\n            return header.toLowerCase().trim()\n        });\n        var indices = _.map(columns, function (col) {\n            var lowCol = col.toLowerCase().trim();\n            return lowHeaders.indexOf(lowCol);\n        });\n\n        for (var r in classification['data']) {\n            var item = classification['data'][r];\n            var row = [item['display_value'], item['parent'], item['order']];\n            row = row.concat(_.map(indices, function (index) {\n                return index === -1 ? '' : body[r][index]\n            }));\n            rows = rows.concat([row])\n        }\n\n        return rows;\n    }\n\n    function getClassificationById(classification_id) {\n        for (c in classifications) {\n            if (classifications[c].classification.id === classification_id) {\n                return classifications[c];\n            }\n        }\n        return null;\n    }\n\n\n    /*\n    EVENT HANDLERS\n    */\n\n    // Switch CHART_OPTIONS panels\n    $('#ethnicity_settings').change(function () {\n        showHideCustomEthnicityPanel();\n        preview();\n    })\n    $('#custom_classification__selector').change(preview);\n\n    // Switch CHART_OPTIONS panels\n    $('#chart_type_selector').change(function () {\n        selectChartType($(this).val())\n        preview()\n    });\n\n    function selectChartType(chart_type) {\n        $('#chart_type_selector').val(chart_type);\n\n        var chartOptionGroupDivs = document.getElementsByClassName('chart-option-group')\n\n        for (var i = 0; i < chartOptionGroupDivs.length; i++) {\n            chartOptionGroupDivs[i].classList.add('hidden')\n        }\n\n        if (chart_type !== 'none') {\n            document.getElementById(chart_type + '_options').classList.remove('hidden')\n            document.getElementById('chart_format_options').classList.remove('hidden')\n        }\n    }\n\n    function selectClassification(classification) {\n        $('#ethnicity_settings').val(classification);\n    }\n\n    function selectCustomValues(customObject) {\n        selectCustomClassification(customObject['code'])\n        selectCustomHasParents(customObject['hasParents'])\n        selectCustomHasAll(customObject['hasAll'])\n        selectCustomHasUnknown(customObject['hasUnknown'])\n    }\n\n    function selectCustomClassification(customClassification) {\n        $('#custom_classification__selector').val(customClassification)\n    }\n\n    function selectCustomHasParents(customValue) {\n           $('#custom_classification__has_parents').prop('checked', customValue)\n    }\n\n    function selectCustomHasUnknown(customValue) {\n            $('#custom_classification__has_unknown').prop('checked', customValue)\n    }\n\n    function selectCustomHasAll(customValue) {\n            $('#custom_classification__has_all').prop('checked', customValue)\n    }\n\n    /*\n    CHART PANEL events\n    */\n\n    // LINE events\n    $('#line__x-axis_column').change(preview);\n\n    // GROUPED-BAR events\n    $('#grouped-bar__data_style').change(function () {\n        if ($(this).val() === \"ethnicity_as_group\") {\n            document.getElementById('grouped-bar__ethnicity_is_group').classList.remove('hidden')\n            document.getElementById('grouped-bar__ethnicity_is_bar').classList.add('hidden')\n        } else {\n            document.getElementById('grouped-bar__ethnicity_is_group').classList.add('hidden')\n            document.getElementById('grouped-bar__ethnicity_is_bar').classList.remove('hidden')\n        }\n        preview();\n    });\n    $('#grouped-bar__bar_column').change(preview);\n    $('#grouped-bar__bar_order').change(preview);\n    $('#grouped-bar__groups_column').change(preview);\n    $('#grouped-bar__groups_order').change(preview);\n\n\n    // COMPONENT events\n    $('#component__data_style').change(function () {\n        if ($(this).val() === \"ethnicity_as_bar\") {\n            document.getElementById('component__ethnicity_is_bar').classList.remove('hidden')\n            document.getElementById('component__ethnicity_is_sections').classList.add('hidden')\n        } else {\n            document.getElementById('component__ethnicity_is_bar').classList.add('hidden')\n            document.getElementById('component__ethnicity_is_sections').classList.remove('hidden')\n        }\n        preview();\n    });\n    $('#component__section_column').change(preview);\n    $('#component__section_order').change(preview);\n    $('#component__bar_column').change(preview);\n    $('#component__bar_order').change(preview);\n\n    // PANEL-BAR events\n    $('#panel-bar__data_style').change(function () {\n        if ($(this).val() === \"ethnicity_as_panel_bars\") {\n            document.getElementById('panel-bar__ethnicity_as_bar').classList.remove('hidden')\n            document.getElementById('panel-bar__ethnicity_as_panels').classList.add('hidden')\n        } else {\n            document.getElementById('panel-bar__ethnicity_as_bar').classList.add('hidden')\n            document.getElementById('panel-bar__ethnicity_as_panels').classList.remove('hidden')\n        }\n        preview();\n    });\n    $('#panel-bar__bar_column').change(preview);\n    $('#panel-bar__bar_order').change(preview);\n    $('#panel-bar__panel_column').change(preview);\n    $('#panel-bar__panel_order').change(preview);\n\n    // PANEL-LINE events\n    $('#panel-line__x-axis_column').change(preview);\n\n\n    // Show-hide NUMBER-FORMAT__OTHER panel\n    $('#number_format').change(function () {\n        if ($(this).val() === 'other') {\n            document.getElementById('other_number_format').classList.remove('hidden')\n        } else {\n            document.getElementById('other_number_format').classList.add('hidden')\n        }\n        preview();\n    });\n\n\n    function initialiseForm() {\n        if (settings.data) {\n            var data_text = _.map(settings.data, function (d) {\n                return d.join('\\t')\n            }).join('\\n');\n            $('#data_text_area').val(data_text);\n\n            handleNewData(function () {\n                document.getElementById('data-panel').classList.add('hidden')\n                document.getElementById('edit-panel').classList.remove('hidden')\n                setupChartbuilderWithSettings(settings);\n                preview()\n            })\n        }\n    }\n\n    function setupChartbuilderWithSettings(settings) {\n        $('#chart_type_selector').val(settings.type);\n        selectChartType(settings.type);\n        if (settings.preset) {\n            selectClassification(settings.preset);\n        }\n        if (settings.custom) {\n            selectCustomValues(settings.custom)\n        }\n\n        showHideCustomEthnicityPanel()\n\n        $('#chart_title').val(settings.chartFormat.chart_title);\n\n        switch (settings.type) {\n            case 'line_graph':\n                var columnValue = settings.chartOptions.x_axis_column;\n                $('#line__x-axis_column').val(columnValue);\n                break;\n            case 'grouped_bar_chart':\n                var dataStyle = settings.chartOptions.data_style;\n                $('#grouped-bar__data_style').val(dataStyle);\n                if (dataStyle === 'ethnicity_as_group') {\n                    $('#grouped-bar__bar_column').val(settings.chartOptions.bar_column);\n                    document.getElementById('grouped-bar__ethnicity_is_group').classList.remove('hidden')\n                    document.getElementById('grouped-bar__ethnicity_is_bar').classList.add('hidden')\n                } else {\n                    $('#grouped-bar__groups_column').val(settings.chartOptions.group_column);\n                    document.getElementById('grouped-bar__ethnicity_is_group').classList.add('hidden')\n                    document.getElementById('grouped-bar__ethnicity_is_bar').classList.remove('hidden')\n                }\n                break;\n            case 'component_chart':\n                var dataStyle = settings.chartOptions.data_style;\n                $('#component__data_style').val(dataStyle);\n                if (dataStyle === 'ethnicity_as_sections') {\n                    $('#component__bar_column').val(settings.chartOptions.bar_column);\n                    $('#component__bar_order').val(settings.chartOptions.bar_order);\n                    document.getElementById('component__ethnicity_is_sections').classList.remove('hidden')\n                    document.getElementById('component__ethnicity_is_bar').classList.add('hidden')\n                } else {\n                    $('#component__section_column').val(settings.chartOptions.section_column);\n                    $('#component__section_order').val(settings.chartOptions.section_order);\n                    document.getElementById('component__ethnicity_is_sections').classList.add('hidden')\n                    document.getElementById('component__ethnicity_is_bar').classList.remove('hidden')\n                }\n                break;\n            case 'panel_bar_chart':\n                var dataStyle = settings.chartOptions.data_style;\n                $('#panel-bar__data_style').val(dataStyle);\n                if (dataStyle === 'ethnicity_as_panels') {\n                    $('#panel-bar__bar_column').val(settings.chartOptions.bar_column);\n                    $('#panel-bar__bar_order').val(settings.chartOptions.bar_order);\n                    document.getElementById('panel-bar__ethnicity_as_bar').classList.add('hidden')\n                    document.getElementById('panel-bar__ethnicity_as_panels').classList.remove('hidden')\n                } else {\n                    $('#panel-bar__panel_column').val(settings.chartOptions.panel_column);\n                    $('#panel-bar__panel_order').val(settings.chartOptions.panel_order);\n                    document.getElementById('panel-bar__ethnicity_as_bar').classList.remove('hidden')\n                    document.getElementById('panel-bar__ethnicity_as_panels').classList.add('hidden')\n                }\n                break;\n            case 'panel_line_chart':\n                var columnValue = settings.chartOptions.x_axis_column;\n                $('#panel-line__x-axis_column').val(columnValue);\n                break;\n            default:\n                break;\n        }\n        $('#number_format').val(settings.chartFormat.number_format);\n        $('#number_format_prefix').val(settings.chartFormat.number_format_prefix);\n        $('#number_format_suffix').val(settings.chartFormat.number_format_suffix);\n        $('#number_format_min').val(settings.chartFormat.number_format_min);\n        $('#number_format_max').val(settings.chartFormat.number_format_max);\n        if (settings.chartFormat.number_format === 'other') {\n            document.getElementById('other_number_format').classList.remove('hidden')\n        }\n    }\n\n\n\n    initialiseForm();\n});\n\n/*\nCustom number format is far more complicated than it needs to be\nHowever it is viable to just use this function to grab it until it becomes a problem\n*/\n\nfunction getNumberFormat() {\n    var format = $('#number_format').val();\n    if (format === 'none') {\n        return { 'multiplier': 1.0, 'prefix': '', 'suffix': '', 'min': '', 'max': '' }\n    } else if (format === 'percent') {\n        return { 'multiplier': 1.0, 'prefix': '', 'suffix': '%', 'min': 0.0, 'max': 100.0 }\n    } else if (format === 'other') {\n        return {\n            'multiplier': 1.0,\n            'prefix': $('#number_format_prefix').val(),\n            'suffix': $('#number_format_suffix').val(),\n            'min': $('#number_format_min').val(),\n            'max': $('#number_format_max').val()\n        }\n    }\n}\n\nfunction getTips() {\n\n    // 1. Basics\n    var basicErrors = validateChart(chart_data);\n    if (basicErrors.length !== 0) {\n        return basicErrors;\n    }\n\n    // 2. Required fields\n    var missingFields = checkRequiredFields();\n    if (missingFields.length !== 0) {\n        return missingFields\n    }\n\n    // 3. Data errors\n    var ethnicityColumn = getEthnicityColumnHeader();\n    var secondaryColumn = getSecondaryColumnHeader();\n\n    var dataErrors = validateData(chart_data, ethnicityColumn, secondaryColumn);\n    return dataErrors;\n}\n\nvar MISSING_FIELD_ERROR = 'Missing field error';\n\nfunction checkRequiredFields() {\n    if ($('#ethnicity_settings').val() === 'custom' && $('#custom_classification__selector').val() === 'Please select') {\n        return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'custom_classification__selector' }]\n    }\n\n    var chartType = $('#chart_type_selector').val();\n\n    switch (chartType) {\n        case 'bar_chart':\n            return [];\n            ;\n            break;\n        case 'line_graph':\n            if ($('#line__x-axis_column').val() === 'Please select') {\n                return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'line__x-axis_column' }]\n            }\n            ;\n            break;\n        case 'grouped_bar_chart':\n            if ($('#grouped-bar__data_style').val() === 'ethnicity_as_group') {\n                if ($('#grouped-bar__bar_column').val() === 'Please select') {\n                    return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'grouped-bar__bar_column' }]\n                }\n                ;\n            } else {\n                if ($('#grouped-bar__groups_column').val() === 'Please select') {\n                    return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'grouped-bar__groups_column' }]\n                }\n                ;\n            }\n            break;\n        case 'component_chart':\n            if ($('#component__data_style').val() === 'ethnicity_as_sections') {\n                if ($('#component__bar_column').val() === 'Please select') {\n                    return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'component__bar_column' }]\n                }\n                ;\n            } else {\n                if ($('#component__section_column').val() === 'Please select') {\n                    return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'component__section_column' }]\n                }\n                ;\n            }\n            break;\n        case 'panel_bar_chart':\n            if ($('#panel-bar__data_style').val() === 'ethnicity_as_panels') {\n                if ($('#panel-bar__bar_column').val() === 'Please select') {\n                    return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'panel-bar__bar_column' }]\n                }\n                ;\n            } else {\n                if ($('#panel-bar__panel_column').val() === 'Please select') {\n                    return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'panel-bar__panel_column' }]\n                }\n                ;\n            }\n            break;\n        case 'panel_line_chart':\n            if ($('#panel-line__x-axis_column').val() === 'Please select') {\n                return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'panel-line__x-axis_column' }]\n            }\n            ;\n            break;\n        default:\n            return [{ 'errorType': MISSING_FIELD_ERROR, 'field': 'chart_type_selector' }]\n    }\n    return [];\n}\n\n\nfunction getEthnicityColumnHeader() {\n    for (var i in chart_data[0]) {\n        var lower = chart_data[0][i].toLowerCase();\n        if (lower.search('ethnic') >= 0) {\n            return chart_data[0][i]\n        }\n    }\n    return null\n}\n\nfunction getSecondaryColumnHeader() {\n    var chartType = $('#chart_type_selector').val();\n    switch (chartType) {\n        case 'bar_chart':\n            return null;\n        case 'line_graph':\n            return $('#line__x-axis_column').val();\n        case 'grouped_bar_chart':\n            if ($('#grouped-bar__data_style').val() === 'ethnicity_as_group') {\n                return $('#grouped-bar__bar_column').val()\n            } else {\n                return $('#grouped-bar__groups_column').val()\n            }\n        case 'component_chart':\n            if ($('#component__data_style').val() === 'ethnicity_as_sections') {\n                return $('#component__bar_column').val()\n            } else {\n                return $('#component__section_column').val()\n            }\n        case 'panel_bar_chart':\n            if ($('#panel-bar__data_style').val() === 'ethnicity_as_panels') {\n                return $('#panel-bar__bar_column').val()\n            } else {\n                return $('#panel-bar__panel_column').val()\n            }\n        case 'panel_line_chart':\n            return $('#panel-line__x-axis_column').val();\n        default:\n            return null;\n    }\n}\n\nfunction pasteJson(json) {\n    var data_text_area = document.getElementById('data_text_area');\n\n    data_text_area.value = _.map(json, function (row) {\n        return row.join('\\t');\n    }).join('\\n');\n    data_text_area.dispatchEvent(new Event(\"keyup\"));\n}\n\n\nfunction hideErrors() {\n    document.getElementById('errors_container').classList.add('hidden')\n    $('.govuk-error-message').addClass('hidden')\n    $('.govuk-form-group--error').removeClass('govuk-form-group--error')\n}\n"],"sourceRoot":"../src"}