var classifications=[],table_data=null,current_data="",current_settings=null,unselectedOptionString="Please select";function getEthnicityColumn(e){for(var t=0;t<e.length;t++){if(0<=e[t].toLowerCase().trim().indexOf("ethnic"))return t}return-1}function getEthnicityValues(e){var t=_.clone(e),n=getEthnicityColumn(t.shift());return 0<=n?_.pluck(t,n):[]}function getIsSimpleData(e){var t=getEthnicityValues(e);return(t=_.uniq(t)).length===e.length-1}function getNumberFormat(){var e=$("#number_format").val();return"none"===e?{multiplier:1,prefix:"",suffix:"",min:"",max:""}:"percent"===e?{multiplier:1,prefix:"",suffix:"%",min:0,max:100}:"other"===e?{multiplier:1,prefix:$("#number_format_prefix").val(),suffix:$("#number_format_suffix").val(),min:$("#number_format_min").val(),max:$("#number_format_max").val()}:void 0}function getTips(){var e=validateTable(table_data);if(0!==e.length)return e;var t=checkRequiredFields();if(0!==t.length)return t;var n=getEthnicityColumnHeader(),a=getSecondaryColumnHeader();return validateData(table_data,n,a)}document.addEventListener("DOMContentLoaded",function(){function r(t){var e=document.getElementById("data_text_area").value;0<(table_data=textToData(e)).length&&(message=table_data.length-1+" rows by "+table_data[0].length+" columns"),document.getElementById("data-description").innerHTML=message,function(e){var t=o(e,"none","[None]"),n=(o(e,"[None]","[None]"),o(e,unselectedOptionString,unselectedOptionString));$("#ethnicity-as-row__columns").html(n),$("#ethnicity-as-row__column-order").html(n),$("#ethnicity-as-column__rows").html(n),$("#ethnicity-as-column__row-order").html(n),$("#table_column_1").html(n),$("#table_column_2").html(t),$("#table_column_3").html(t),$("#table_column_4").html(t),$("#table_column_5").html(t),$("#index_column_name").val("Ethnicity")}(table_data[0]);var n=getEthnicityValues(table_data);$.ajax({type:"post",url:url_get_classifications,dataType:"json",data:JSON.stringify({data:n}),contentType:"application/json; charset=utf-8",success:function(e){(function(e){var t="";for(var n in e){var a=e[n].classification.name,r=e[n].classification.id;t=0===n?t+'<option value="'+r+'" selected>'+a+"</option>":t+'<option value="'+r+'" >'+a+"</option>"}document.getElementById("ethnicity_settings").innerHTML=t})(classifications=e.classifications),a(),document.getElementById("ethnicity_settings_section").classList.remove("hidden"),getIsSimpleData(table_data)?document.getElementById("complex_table_options").classList.add("hidden"):document.getElementById("complex_table_options").classList.remove("hidden"),t&&t()},failure:function(){console.log("failed to get ethnicity classifications")},error:function(e){console.log(e)}})}function a(){"custom"===$("#ethnicity_settings").val()?document.getElementById("custom_classification__panel").classList.remove("hidden"):document.getElementById("custom_classification__panel").classList.add("hidden")}function o(e,t,n){var a='<option value="'+t+'" selected>'+n+"</option>",r=function(e){var t=[],n=[];for(h in e){var a=e[h];t.indexOf(a)<0&&n.push(a)}return n}(e);for(var o in r){var i=r[o];a=a+'<option value="'+i+'">'+i+"</option>"}return a}function e(e){var t=$("#"+this.id+" option:selected").val(),n=t===unselectedOptionString?"":t;$("#"+this.id+"_name").val(n),i(e)}function i(e){hideErrors();var t=getTips();0<t.length?function(e){document.getElementById("preview_container").classList.add("hidden");for(var t=document.getElementById("tip-list"),n=0;n<t.children.length;n++)t.children[n].classList.add("hidden");document.getElementById("errors_container").classList.remove("hidden"),0<l(e,ETHNICITY_ERROR).length&&(document.getElementById("tip__ethnicity-column").classList.remove("hidden"),document.getElementById("tab_seperated_content").classList.add("govuk-form-group--error"),document.getElementById("data-edit-error").classList.remove("hidden"));0<l(e,RECTANGLE_ERROR).length&&(document.getElementById("tip__rectangular-data").classList.remove("hidden"),document.getElementById("tab_seperated_content").classList.add("govuk-form-group--error"),document.getElementById("data-edit-error").classList.remove("hidden"));0<l(e,DATA_ERROR_DUPLICATION).length&&(document.getElementById("tip__duplicate-data").classList.remove("hidden"),document.getElementById("tab_seperated_content").classList.add("govuk-form-group--error"),document.getElementById("data-edit-error").classList.remove("hidden"),document.getElementById("complex_table_options").classList.add("govuk-form-group--error"),document.getElementById("table-options-error").classList.remove("hidden"));0<l(e,DATA_ERROR_MISSING_DATA).length&&(document.getElementById("tip__missing-data").classList.remove("hidden"),document.getElementById("tab_seperated_content").classList.add("govuk-form-group--error"),document.getElementById("data-edit-error").classList.remove("hidden"),document.getElementById("complex_table_options").classList.add("govuk-form-group--error"),document.getElementById("table-options-error").classList.remove("hidden"));0<l(e,DATA_ERROR_COMPLEX_DATA).length&&(document.getElementById("tip__complex-data").classList.remove("hidden"),document.getElementById("tab_seperated_content").classList.add("govuk-form-group--error"),document.getElementById("data-edit-error").classList.remove("hidden"),document.getElementById("complex_table_options").classList.add("govuk-form-group--error"),document.getElementById("table-options-error").classList.remove("hidden"));if(0<l(e,MISSING_FIELD_ERROR).length){document.getElementById("tip__required-settings").classList.remove("hidden"),document.getElementById("settings-error-anchor-link").href="#"+e[0].field+"-error";var a=document.getElementById(e[0].field+"-error");a&&(a.classList.remove("hidden"),a.closest(".chart-builder-section").classList.add("govuk-form-group--error"))}}(t):function(){document.getElementById("preview_container").classList.remove("hidden");var e=g();e&&(e.title&&e.title.text&&$("#title-container").html('<h3 class="heading-small">'+e.title.text+"</h3>"),e.title="",drawTable("container",e),document.getElementById("save_section").classList.remove("hidden"));document.getElementById("table_title").dispatchEvent(new Event("input"))}()}function l(e,t){return _.filter(e,function(e){return e.errorType===t})}function s(){return{data:textToData($("#data_text_area").val()),preset:u(),custom:m(),tableOptions:function(){{if(getIsSimpleData(table_data))return{};var e=$("#complex-table__data-style").val(),t="ethnicity_as_row"===e?$("#ethnicity-as-row__columns").val():$("#ethnicity-as-column__rows").val(),n="ethnicity_as_row"===e?$("#ethnicity-as-row__column-order").val():$("#ethnicity-as-column__row-order").val();return{data_style:$("#complex-table__data-style").val(),selection:t,order:n}}}(),tableValues:{table_title:$("#table_title").val(),table_column_1:$("#table_column_1").val(),table_column_1_name:$("#table_column_1_name").val(),table_column_2:$("#table_column_2").val(),table_column_2_name:$("#table_column_2_name").val(),table_column_3:$("#table_column_3").val(),table_column_3_name:$("#table_column_3_name").val(),table_column_4:$("#table_column_4").val(),table_column_4_name:$("#table_column_4_name").val(),table_column_5:$("#table_column_5").val(),table_column_5_name:$("#table_column_5_name").val(),table_index_column_name:$("#index_column_name").val()}}}function u(){return $("#ethnicity_settings").val()}function d(){return $("#custom_classification__selector").val()}function m(){return{code:d(),hasParents:$("#custom_classification__has_parents").prop("checked"),hasAll:$("#custom_classification__has_all").prop("checked"),hasUnknown:$("#custom_classification__has_unknown").prop("checked")}}function f(e){return null!==e&"none"!=e}function v(){var t=[];return $(".column_option_picker").each(function(e){f($(this).val())&&t.push($(this).val())}),t}function p(){var t=[];return $(".column_option_picker").each(function(e){"none"!==$(this).val()&&t.push($(".column_option_picker_name")[e].value)}),t}function g(){var e=null,t=function(e){for(c in classifications)if(classifications[c].classification.id===e)return classifications[c];return null}($("#ethnicity_settings").val());if(getIsSimpleData(table_data))e=buildTableObject(y(t,table_data,v()),$("#table_title").val(),"","","Ethnicity","Ethnicity-parent","[None]","Ethnicity-order",v(),p(),$("#index_column_name").val(),"[None]");else if("ethnicity_as_row"===$("#complex-table__data-style").val()){var n=v().concat(function(){var e=[$("#ethnicity-as-row__columns").val()];return f($("#ethnicity-as-row__column-order").val())&&e.push($("#ethnicity-as-row__column-order").val()),e}());e=buildTableObject(y(t,table_data,n),$("#table_title").val(),"","","Ethnicity","Ethnicity-parent",$("#ethnicity-as-row__columns").val(),"Ethnicity-order",v(),p(),$("#index_column_name").val(),$("#ethnicity-as-row__column-order").val())}else{n=v().concat(function(){var e=[$("#ethnicity-as-column__rows").val()];return f($("#ethnicity-as-column__row-order").val())&&e.push($("#ethnicity-as-column__row-order").val()),e}());e=buildTableObject(y(t,table_data,n),$("#table_title").val(),"","",$("#ethnicity-as-column__rows").val(),"","Ethnicity",$("#ethnicity-as-column__row-order").val(),v(),p(),$("#index_column_name").val(),"Ethnicity-order")}return e}function y(e,t,n){var a=[["Ethnicity","Ethnicity-parent","Ethnicity-order"].concat(n)],r=_.clone(t),o=r.shift(),i=_.map(o,function(e){return e.toLowerCase().trim()}),l=_.map(n,function(e){var t=e.toLowerCase().trim();return i.indexOf(t)});for(var c in e.data){var s=e.data[c],u=[s.display_value,s.parent,s.order];u=u.concat(_.map(l,function(e){return-1===e?"":r[c][e]})),a=a.concat([u])}return a}function t(e){!function(e){$("#custom_classification__selector").val(e)}(e.code),function(e){$("#custom_classification__has_parents").prop("checked",e)}(e.hasParents),function(e){$("#custom_classification__has_all").prop("checked",e)}(e.hasAll),function(e){$("#custom_classification__has_unknown").prop("checked",e)}(e.hasUnknown)}function n(){"ethnicity_as_row"===$("#complex-table__data-style").val()?(document.getElementById("complex-table__ethnicity-is-row").classList.remove("hidden"),document.getElementById("complex-table__ethnicity-is-column").classList.add("hidden")):(document.getElementById("complex-table__ethnicity-is-row").classList.add("hidden"),document.getElementById("complex-table__ethnicity-is-column").classList.remove("hidden"))}function E(){var e=$("#index_column_name").val();(0<=table_data[0].indexOf(e)||e===unselectedOptionString)&&("ethnicity_as_column"===$("#complex-table__data-style").val()?$("#index_column_name").val($("#ethnicity-as-column__rows").val()):$("#index_column_name").val("Ethnicity")),i()}function b(e){e.preset&&function(e){$("#ethnicity_settings").val(e)}(e.preset),e.custom&&t(e.custom),a(),$("#table_title").val(e.tableValues.table_title),document.getElementById("table_title").dispatchEvent(new Event("input")),$("#complex-table__data-style").val(e.tableOptions.data_style),e.tableOptions.order==NONE_VALUE&&(e.tableOptions.order=e.tableOptions.selection),"ethnicity_as_row"===e.tableOptions.data_style?($("#ethnicity-as-row__columns").val(e.tableOptions.selection),$("#ethnicity-as-row__column-order").val(e.tableOptions.order)):($("#ethnicity-as-column__rows").val(e.tableOptions.selection),$("#ethnicity-as-column__row-order").val(e.tableOptions.order)),n(),$("#table_column_1").val(e.tableValues.table_column_1),$("#table_column_1_name").val(e.tableValues.table_column_1_name),$("#table_column_2").val(e.tableValues.table_column_2),$("#table_column_2_name").val(e.tableValues.table_column_2_name),$("#table_column_3").val(e.tableValues.table_column_3),$("#table_column_3_name").val(e.tableValues.table_column_3_name),$("#table_column_4").val(e.tableValues.table_column_4),$("#table_column_4_name").val(e.tableValues.table_column_4_name),$("#table_column_5").val(e.tableValues.table_column_5),$("#table_column_5_name").val(e.tableValues.table_column_5_name),$("#index_column_name").val(e.tableValues.table_index_column_name)}document.getElementById("confirm-data").addEventListener("click",function(e){var t=document.getElementById("data_text_area"),n=document.getElementById("data-error"),a=document.getElementById("data-form-group");""!=t.value?(r(function(){current_settings&&b(current_settings),i()}),document.getElementById("data-panel").classList.add("hidden"),document.getElementById("edit-panel").classList.remove("hidden"),document.getElementById("builder-title").innerHTML="Format and view table",document.title="Format and view table",t.classList.remove("govuk-textarea--error"),a.classList.remove("govuk-form-group--error"),n.textContent=""):(t.classList.add("govuk-textarea--error"),a.classList.add("govuk-form-group--error"),n.textContent="Enter some data",n.classList.remove("hidden"),document.getElementById("errors_container").classList.remove("hidden"),document.getElementById("data-missing").classList.remove("hidden"))}),document.getElementById("edit-data").addEventListener("click",function(e){hideErrors(),current_data=document.getElementById("data_text_area").value,current_settings=s(),document.getElementById("data-panel").classList.remove("hidden"),document.getElementById("data_text_area").focus(),document.getElementById("edit-panel").classList.add("hidden"),document.getElementById("builder-title").innerHTML="Create a table",document.title="Create a table"}),document.getElementById("cancel-edit-data").addEventListener("click",function(e){document.getElementById("data_text_area").value=current_data,document.getElementById("data-panel").classList.add("hidden"),document.getElementById("edit-panel").classList.remove("hidden"),document.getElementById("builder-title").innerHTML="Format and view table",document.title="Format and view table",document.getElementById("errors_container").classList.add("hidden"),document.getElementById("data-missing").classList.add("hidden")}),document.getElementById("save").addEventListener("click",function(e){$("#save").attr("disabled","disabled");var t=g(),n=s();t&&function(e,t){e&&($.each(e.series,function(){for(var e=0;e<this.data.length;e++)isNaN(this.data[e].y)&&(this.data[e].y=0)}),$.ajax({type:"POST",url:url_save_table_to_page,dataType:"json",data:JSON.stringify({tableObject:e,source:t,classificationCode:u(),customClassificationCode:d(),customClassification:m(),ethnicityValues:getEthnicityValues(table_data)}),contentType:"application/json",success:function(){document.getElementById("breadcrumb").scrollIntoView(),location.reload()}}))}(t,n)}),$("#ethnicity_settings").change(function(){a(),i()}),$("#custom_classification__selector").change(i),$("#complex-table__data-style").change(function(){n(),E()}),$("#ethnicity-as-row__columns").change(function(){$("#ethnicity-as-row__column-order").val($("#ethnicity-as-row__columns").val()),E()}),$("#ethnicity-as-row__column-order").change(i),$("#ethnicity-as-column__rows").change(function(){$("#ethnicity-as-column__row-order").val($("#ethnicity-as-column__rows").val()),E()}),$("#ethnicity-as-column__row-order").change(i),$("#grouped-bar__bar_order").change(i),$("#grouped-bar__groups_order").change(i),$("#table_column_1_name").change(i),$("#table_column_1").change(e),$("#table_column_2_name").change(i),$("#table_column_2").change(e),$("#table_column_3_name").change(i),$("#table_column_3").change(e),$("#table_column_4_name").change(i),$("#table_column_4").change(e),$("#table_column_5_name").change(i),$("#table_column_5").change(e),$("#index_column_name").change(i),$("#number_format").change(function(){"other"===$(this).val()?document.getElementById("other_number_format").classList.remove("hidden"):document.getElementById("other_number_format").classList.add("hidden"),i()}),function(){if(settings.data){var e=_.map(settings.data,function(e){return e.join("\t")}).join("\n");$("#data_text_area").val(e),r(function(){document.getElementById("data-panel").classList.add("hidden"),document.getElementById("edit-panel").classList.remove("hidden"),b(settings),i()})}}()});var MISSING_FIELD_ERROR="Missing field error";function checkRequiredFields(){if("custom"===$("#ethnicity_settings").val()&&"Please select"===$("#custom_classification__selector").val())return[{errorType:MISSING_FIELD_ERROR,field:"custom_classification__selector"}];if(!1===getIsSimpleData(table_data))if("ethnicity_as_row"===$("#complex-table__data-style").val()){if($("#ethnicity-as-row__columns").val()===unselectedOptionString)return[{errorType:MISSING_FIELD_ERROR,field:"ethnicity-as-row__columns"}];if($("#ethnicity-as-row__column-order").val()===unselectedOptionString)return[{errorType:MISSING_FIELD_ERROR,field:"ethnicity-as-row__column-order"}]}else{if($("#ethnicity-as-column__rows").val()===unselectedOptionString)return[{errorType:MISSING_FIELD_ERROR,field:"ethnicity-as-column__rows"}];if($("#ethnicity-as-column__row-order").val()===unselectedOptionString)return[{errorType:MISSING_FIELD_ERROR,field:"ethnicity-as-column__row-order"}]}return $("#table_column_1").val()===unselectedOptionString?[{errorType:MISSING_FIELD_ERROR,field:"table_column_1"}]:[]}function getEthnicityColumnHeader(){for(var e in table_data[0]){if(0<=table_data[0][e].toLowerCase().search("ethnic"))return table_data[0][e]}return null}function getSecondaryColumnHeader(){return getIsSimpleData(table_data)?null:"ethnicity_as_row"===$("#complex-table__data-style").val()?$("#ethnicity-as-row__columns").val():$("#ethnicity-as-column__rows").val()}function pasteJson(e){var t=document.getElementById("data_text_area");t.value=_.map(e,function(e){return e.join("\t")}).join("\n"),t.dispatchEvent(new Event("keyup"))}function hideErrors(){document.getElementById("errors_container").classList.add("hidden"),$(".govuk-error-message").addClass("hidden"),$(".govuk-form-group--error").removeClass("govuk-form-group--error")}var DATA_ERROR_DUPLICATION="duplication",DATA_ERROR_MISSING_DATA="missing data",DATA_ERROR_SETTINGS_ERROR="settings",DATA_ERROR_COMPLEX_DATA="complex data";function validateData(e,t,n){var a=_.clone(e),r=a.shift(),o=_.map(r,function(e){return e.trim().toLowerCase()}),i=index_of_column_named(o,t);if(null===i)return[{error:"could not find data column",column:t,errorType:DATA_ERROR_SETTINGS_ERROR}];if(null===n)return validateSimpleData(a,i,t);var l=index_of_column_named(o,n);return null===l?[{error:"could not find data column",column:n,errorType:DATA_ERROR_SETTINGS_ERROR}]:validateGroupedData(a,i,l,t,n)}function validateDataDuplicatesOnly(e,t,n){var a=_.clone(e),r=a.shift(),o=_.map(r,function(e){return e.trim().toLowerCase()}),i=index_of_column_named(o,t);if(null===i)return[{error:"could not find data column",column:t}];if(null===n)return validateSimpleData(a,i);var l=index_of_column_named(o,n);return null===l?[{error:"could not find data column",column:n}]:validateGroupedDataDuplicates(a,i,l)}function validateSimpleData(e,n,a){var r=[],t=_.uniq(_.map(e,function(e){return e[n]}));if(t.length===e.length)return[];if(e.length%t.length==0)return[{errorType:DATA_ERROR_COMPLEX_DATA}];var o={};return _.forEach(e,function(e){var t=e[n];t in o?"added to errors"!==o[t]&&(r.push({error:"duplicate data",category:t,categoryColumn:a,errorType:DATA_ERROR_DUPLICATION}),o[t]="added to errors"):o[t]="value in dict"}),r}function validateGroupedData(e,t,n,a,r){var o=validateGroupedDataCompleteness(e,t,n,a,r),i=validateGroupedDataDuplicates(e,t,n,a,r);return o.concat(i)}function validateGroupedDataCompleteness(e,n,a,r,o){var t=_.uniq(_.map(e,function(e){return e[n]})),i=_.uniq(_.map(e,function(e){return e[a]})),l=[],c=_.object(_.map(t,function(t){return[t,_.map(_.filter(e,function(e){return e[n]===t}),function(e){return e[a]})]}));return _.forEach(t,function(t){_.forEach(i,function(e){_.contains(c[t],e)||l.push({error:"missing data",category:t,group:e,categoryColumn:r,groupColumn:o,errorType:DATA_ERROR_MISSING_DATA})})}),l}function validateGroupedDataDuplicates(e,a,r,o,i){var l=[],c={};return _.forEach(e,function(e){var t=e[a],n=e[r];t in c?n in c[t]?l.push({error:"duplicate data",category:e[a],group:e[r],categoryColumn:o,groupColumn:i,errorType:DATA_ERROR_DUPLICATION}):c[t][n]=1:(c[t]={},c[t][n]=1)}),l}function errorDescription(e){switch(e.errorType){case DATA_ERROR_SETTINGS_ERROR:return"Column '"+e.column+"' not found";case DATA_ERROR_MISSING_DATA:return"The data is missing a row for "+e.categoryColumn+" = '"+e.category+"' and "+e.groupColumn+" = '"+e.group+"'";case DATA_ERROR_DUPLICATION:return"group"in e?"The data has duplicate entries for the rows with "+e.categoryColumn+" = '"+e.category+"' and "+e.groupColumn+" = '"+e.group+"'":"The data has duplicate entries for "+e.categoryColumn+" = '"+e.category+"'"}}function errorResolutionHint(e){switch(e.errorType){case DATA_ERROR_SETTINGS_ERROR:return"Make sure the column values selected for this table are valid";case DATA_ERROR_MISSING_DATA:return"Add rows to your source spreadsheet and try again";case DATA_ERROR_DUPLICATION:return"Remove data rows in your source spreadsheet and try again"}}if("undefined"!=typeof exports){var _=require("../charts/vendor/underscore-min"),dataTools=require("../charts/rd-data-tools"),index_of_column_named=dataTools.index_of_column_named;exports.validateSimpleData=validateSimpleData,exports.validateGroupedData=validateGroupedData,exports.validateData=validateData,exports.DATA_ERROR_DUPLICATION=DATA_ERROR_DUPLICATION,exports.DATA_ERROR_MISSING_DATA=DATA_ERROR_MISSING_DATA,exports.DATA_ERROR_COMPLEX_DATA=DATA_ERROR_COMPLEX_DATA,exports.DATA_ERROR_SETTINGS_ERROR=DATA_ERROR_SETTINGS_ERROR}function filterData(e,t){return applyFilter(e,textFilterToIndexFilter(e,t))}function numerateColumns(t,e){_.forEach(e,function(e){numerateColumn(t,e)})}function numerateColumn(e,t){var n=e[0].indexOf(t);for(row=1;row<e.length;row++)row[n]=row[n].toFloat()}function textFilterToIndexFilter(e,t){var n={},a=e[0];for(var r in t){n[a.indexOf(r)]=t[r]}return n}function applyFilter(e,t){var n=_.clone(e),a=n.shift(),r=[];for(var o in n){var i=n[o];itemPassesFilter(i,t)&&r.push(i)}return r.unshift(a),r}function itemPassesFilter(e,t){if(""===e[0])return!1;for(var n in t)if(e[n]!==t[n])return!1;return!0}function formatNumber(e){var t=e.replaceAll("%",""),n=(1*t).toLocaleString("en-uk");return"NaN"===n?t:n}function formatNumberWithDecimalPlaces(e,t){var n=""+e;if(n.match(/\d/))try{n=n.replace("%","")}finally{var a=(1*n).toLocaleString("en-uk",{minimumFractionDigits:t,maximumFractionDigits:t});if("NaN"!==a)return a}return n}function seriesDecimalPlaces(e){var t=0;for(var n in e){var a=decimalPlaces(e[n]);t<a&&(t=a)}return t}function seriesCouldBeYear(e){for(var t in e){var n=e[t];if(0<decimalPlaces(n)||n<1950||2050<n)return!1}return!0}function decimalPlaces(e){var t=(e?String(e):"").match(/\.(\d*[1-9])/);return t?t[1].length:0}function uniqueDataInColumnOrdered(e,t,n){var a=_.sortBy(e,function(e){return e[n]}),r=_.map(a,function(e){return e[t]});return _.uniq(r)}function uniqueDataInColumnMaintainOrder(e,t){var n=[],a={};return _.forEach(e,function(e){e[t]in a||(n.push(e[t]),a[e[t]]=1)}),n}function textToData(e){var t="\t";e.search(t)<0&&(t="|"),splitLineAndTrimEachItem=function(e){return _.map(e.split(t),function(e){return e.trim()})};var n=e.trim().split("\n");return _.map(n,splitLineAndTrimEachItem)}var ETHNICITY_ERROR="Ethnicity column error",VALUE_ERROR="Value column error",RECTANGLE_ERROR="Data table error";function validateChart(e){var t=[];return!1===hasHeader("ethnic",e)&&t.push({errorType:ETHNICITY_ERROR}),!1===hasHeader("value",e)&&t.push({errorType:VALUE_ERROR}),!1===isRectangular(e)&&t.push({errorType:RECTANGLE_ERROR}),t}function validateTable(e){var t=[];return!1===hasHeader("ethnic",e)&&t.push({errorType:ETHNICITY_ERROR}),t}function hasHeader(t,e){var n=e[0],a=!1;return _.forEach(n,function(e){0<=e.toLowerCase().search(t)&&(a=!0)}),a}function isRectangular(e){for(var t=e[0].length,n=1;n<e.length;n++)if(e[n].length!==t)return!1;return!0}function nonNumericData(e,t){var a=[],n=e.slice(1);return _.forEach(n,function(n){_.forEach(t,function(e){var t=n[e];isNaN(t)&&a.push(t)})}),a}function index_of_column_named(e,t){if(t&&""!==t){var n=e.indexOf(t.trim().toLowerCase());return-1===n?null:n}return null}if("undefined"!=typeof exports){_=require("./vendor/underscore-min");exports.hasHeader=hasHeader,exports.decimalPlaces=decimalPlaces,exports.seriesDecimalPlaces=seriesDecimalPlaces,exports.seriesCouldBeYear=seriesCouldBeYear,exports.formatNumberWithDecimalPlaces=formatNumberWithDecimalPlaces,exports.uniqueDataInColumnOrdered=uniqueDataInColumnOrdered,exports.uniqueDataInColumnMaintainOrder=uniqueDataInColumnMaintainOrder,exports.validateChart=validateChart,exports.textToData=textToData,exports.nonNumericData=nonNumericData,exports.index_of_column_named=index_of_column_named,exports.ETHNICITY_ERROR=ETHNICITY_ERROR,exports.VALUE_ERROR=VALUE_ERROR}
//# sourceMappingURL=tablebuilder.js.map
