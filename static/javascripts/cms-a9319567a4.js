function DynamicResizingTextarea(e){this.element=e}function ethnicityDataValueFields(e){var t,n;e=e;"querySelector"in document&&"addEventListener"in document&&Function.prototype.bind&&function(){e&&(t=e.querySelector("select.ethnicity-categorisation"),n=e.querySelector("input.broad-values"),t&&n&&(t.addEventListener("change",function(){r()}.bind(this)),r()))}();function r(){"true"==t.selectedOptions[0].getAttribute("data-parents")?n.removeAttribute("disabled"):(n.checked=!1,n.setAttribute("disabled","disabled"))}}$.ajaxSetup({beforeSend:function(e){e.setRequestHeader("X-CSRFToken",user_csrf_token)}}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.accessibleAutocomplete=t():e.accessibleAutocomplete=t()}(this,function(){return o={},r.m=n=[function(v,e,t){!function(){"use strict";function l(){}function n(e,t){var n,r,o,a,i=p;for(a=arguments.length;2<a--;)d.push(arguments[a]);for(t&&null!=t.children&&(d.length||d.push(t.children),delete t.children);d.length;)if((r=d.pop())&&void 0!==r.pop)for(a=r.length;a--;)d.push(r[a]);else!0!==r&&!1!==r||(r=null),(o="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r=String(r):"string"!=typeof r&&(o=!1)),o&&n?i[i.length-1]+=r:i===p?i=[r]:i.push(r),n=o;var u=new l;return u.nodeName=e,u.children=i,u.attributes=null==t?void 0:t,u.key=null==t?void 0:t.key,void 0!==q.vnode&&q.vnode(u),u}function A(e,t){for(var n in t)e[n]=t[n];return e}function a(e){!e.__d&&(e.__d=!0)&&1==o.push(e)&&(q.debounceRendering||setTimeout)(t)}function t(){var e,t=o;for(o=[];e=t.pop();)e.__d&&P(e)}function x(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function T(e){var t=A({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function N(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t,n,r,o){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),r&&r(e);else if("class"!==t||o)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var a in n)a in r||(e.style[a]="");for(var a in r)e.style[a]="number"==typeof r[a]&&!1===f.test(a)?r[a]+"px":r[a]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var i=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,s,i):e.removeEventListener(t,s,i),(e.__l||(e.__l={}))[t]=r}else if("list"!==t&&"type"!==t&&!o&&t in e)(function(e,t,n){try{e[t]=n}catch(e){}})(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t);else{var u=o&&t!==(t=t.replace(/^xlink\:?/,""));null==r||!1===r?u?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(u?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function s(e){return this.__l[e.type](q.event&&q.event(e)||e)}function w(){for(var e;e=j.pop();)q.afterMount&&q.afterMount(e),e.componentDidMount&&e.componentDidMount()}function D(e,t,n,r,o,a){M++||(_=null!=o&&void 0!==o.ownerSVGElement,h=null!=e&&!("__preactattr_"in e));var i=R(e,t,n,r,a);return o&&i.parentNode!==o&&o.appendChild(i),--M||(h=!1,a||w()),i}function R(e,t,n,r,o){var a=e,i=_;if(null==t&&(t=""),"string"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||o)?e.nodeValue!=t&&(e.nodeValue=t):(a=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(a,e),S(e,!0))),a.__preactattr_=!0,a;if("function"==typeof t.nodeName)return function(e,t,n,r){for(var o=e&&e._component,a=o,i=e,u=o&&e._componentConstructor===t.nodeName,l=u,s=T(t);o&&!l&&(o=o.__u);)l=o.constructor===t.nodeName;return o&&l&&(!r||o._component)?(k(o,s,3,n,r),e=o.base):(a&&!u&&(L(a),e=i=null),o=I(t.nodeName,s,n),e&&!o.__b&&(o.__b=e,i=null),k(o,s,1,n,r),e=o.base,i&&e!==i&&(i._component=null,S(i,!1))),e}(e,t,n,r);if(_="svg"===t.nodeName||"foreignObject"!==t.nodeName&&_,(!e||!x(e,String(t.nodeName)))&&(a=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.__n=e,n}(String(t.nodeName),_),e)){for(;e.firstChild;)a.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(a,e),S(e,!0)}var u=a.firstChild,l=a.__preactattr_||(a.__preactattr_={}),s=t.children;return!h&&s&&1===s.length&&"string"==typeof s[0]&&null!=u&&void 0!==u.splitText&&null==u.nextSibling?u.nodeValue!=s[0]&&(u.nodeValue=s[0]):(s&&s.length||null!=u)&&function(e,t,n,r,o){var a,i,u,l,s=e.childNodes,c=[],d={},p=0,f=0,_=s.length,h=0,m=t?t.length:0;if(0!==_)for(var v=0;v<_;v++){var g=s[v],b=g.__preactattr_;null!=(y=m&&b?g._component?g._component.__k:b.key:null)?(p++,d[y]=g):(b||(void 0!==g.splitText?!o||g.nodeValue.trim():o))&&(c[h++]=g)}if(0!==m)for(v=0;v<m;v++){var y;if(u=t[v],(l=null)!=(y=u.key))p&&void 0!==d[y]&&(l=d[y],d[y]=void 0,p--);else if(!l&&f<h)for(a=f;a<h;a++)if(void 0!==c[a]&&(O=i=c[a],C=o,"string"==typeof(E=u)||"number"==typeof E?void 0!==O.splitText:"string"==typeof E.nodeName?!O._componentConstructor&&x(O,E.nodeName):C||O._componentConstructor===E.nodeName)){l=i,c[a]=void 0,a===h-1&&h--,a===f&&f++;break}(l=R(l,u,n,r))&&l!==e&&(_<=v?e.appendChild(l):l!==s[v]&&(l===s[v+1]?N(s[v]):e.insertBefore(l,s[v]||null)))}var O,E,C;if(p)for(var v in d)void 0!==d[v]&&S(d[v],!1);for(;f<=h;)void 0!==(l=c[h--])&&S(l,!1)}(a,s,n,r,h||null!=l.dangerouslySetInnerHTML),function(e,t,n){var r;for(r in n)t&&null!=t[r]||null==n[r]||c(e,r,n[r],n[r]=void 0,_);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||c(e,r,n[r],n[r]=t[r],_)}(a,t.attributes,l),_=i,a}function S(e,t){var n=e._component;n?L(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||N(e),r(e))}function r(e){for(e=e.lastChild;e;){var t=e.previousSibling;S(e,!0),e=t}}function I(e,t,n){var r,o=m[e.name];if(e.prototype&&e.prototype.render?(r=new e(t,n),u.call(r,t,n)):((r=new u(t,n)).constructor=e,r.render=i),o)for(var a=o.length;a--;)if(o[a].constructor===e){r.__b=o[a].__b,o.splice(a,1);break}return r}function i(e,t,n){return this.constructor(e,n)}function k(e,t,n,r,o){e.__x||(e.__x=!0,(e.__r=t.ref)&&delete t.ref,(e.__k=t.key)&&delete t.key,!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.__c||(e.__c=e.context),e.context=r),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&!1===q.syncComponentUpdates&&e.base?a(e):P(e,1,o)),e.__r&&e.__r(e))}function P(e,t,n,r){if(!e.__x){var o,a,i,u=e.props,l=e.state,s=e.context,c=e.__p||u,d=e.__s||l,p=e.__c||s,f=e.base,_=e.__b,h=f||_,m=e._component,v=!1;if(f&&(e.props=c,e.state=d,e.context=p,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(u,l,s)?v=!0:e.componentWillUpdate&&e.componentWillUpdate(u,l,s),e.props=u,e.state=l,e.context=s),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!v){o=e.render(u,l,s),e.getChildContext&&(s=A(A({},s),e.getChildContext()));var g,b,y=o&&o.nodeName;if("function"==typeof y){var O=T(o);(a=m)&&a.constructor===y&&O.key==a.__k?k(a,O,1,s,!1):(g=a,e._component=a=I(y,O,s),a.__b=a.__b||_,a.__u=e,k(a,O,0,s,!1),P(a,1,n,!0)),b=a.base}else i=h,(g=m)&&(i=e._component=null),!h&&1!==t||(i&&(i._component=null),b=D(i,o,s,n||!f,h&&h.parentNode,!0));if(h&&b!==h&&a!==m){var E=h.parentNode;E&&b!==E&&(E.replaceChild(b,h),g||(h._component=null,S(h,!1)))}if(g&&L(g),(e.base=b)&&!r){for(var C=e,x=e;x=x.__u;)(C=x).base=b;b._component=C,b._componentConstructor=C.constructor}}if(!f||n?j.unshift(e):v||(w(),e.componentDidUpdate&&e.componentDidUpdate(c,d,p),q.afterUpdate&&q.afterUpdate(e)),null!=e.__h)for(;e.__h.length;)e.__h.pop().call(e);M||r||w()}}function L(e){q.beforeUnmount&&q.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?L(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),N(e.__b=t),function(e){var t=e.constructor.name;(m[t]||(m[t]=[])).push(e)}(e),r(t)),e.__r&&e.__r(null)}function u(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{}}var q={},d=[],p=[],f=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,o=[],j=[],M=0,_=!1,h=!1,m={};A(u.prototype,{setState:function(e,t){var n=this.state;this.__s||(this.__s=A({},n)),A(n,"function"==typeof e?e(n,this.props):e),t&&(this.__h=this.__h||[]).push(t),a(this)},forceUpdate:function(e){e&&(this.__h=this.__h||[]).push(e),P(this,2)},render:function(){}});var e={h:n,createElement:n,cloneElement:function(e,t){return n(e.nodeName,A(A({},e.attributes),t),2<arguments.length?[].slice.call(arguments,2):e.children)},Component:u,render:function(e,t,n){return D(n,e,{},!1,t,!1)},rerender:t,options:q};v.exports=e}()},function(e,t,n){e.exports=n(2)},function(e,t,n){"use strict";function o(e){if(!e.element)throw new Error("element is not defined");if(!e.id)throw new Error("id is not defined");if(!e.source)throw new Error("source is not defined");Array.isArray(e.source)&&(e.source=function(n){return function(t,e){e(n.filter(function(e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}))}}(e.source)),(0,i.render)((0,i.createElement)(l.default,e),e.element)}var r,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=n(0),u=n(3),l=(r=u)&&r.__esModule?r:{default:r};o.enhanceSelectElement=function(n){if(!n.selectElement)throw new Error("selectElement is not defined");if(!n.source){var e=[].filter.call(n.selectElement.options,function(e){return e.value||n.preserveNullOptions});n.source=e.map(function(e){return e.textContent||e.innerText})}if(n.onConfirm=n.onConfirm||function(t){var e=[].filter.call(n.selectElement.options,function(e){return(e.textContent||e.innerText)===t})[0];e&&(e.selected=!0)},n.selectElement.value||void 0===n.defaultValue){var t=n.selectElement.options[n.selectElement.options.selectedIndex];n.defaultValue=t.textContent||t.innerText}void 0===n.name&&(n.name=""),void 0===n.id&&(void 0===n.selectElement.id?n.id="":n.id=n.selectElement.id),void 0===n.autoselect&&(n.autoselect=!0);var r=document.createElement("span");n.selectElement.parentNode.insertBefore(r,n.selectElement),o(a({},n,{element:r})),n.selectElement.style.display="none",n.selectElement.id=n.selectElement.id+"-select"},e.exports=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function d(){return!(!navigator.userAgent.match(/(iPod|iPhone|iPad)/g)||!navigator.userAgent.match(/AppleWebKit/g))}t.__esModule=!0,t.default=void 0;var o,a,i,u,l,s,H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$=n(0),W=r(n(4)),c=r(n(5)),p={13:"enter",27:"escape",32:"space",38:"up",40:"down"},K=((s=document.createElement("x")).style.cssText="pointer-events:auto","auto"===s.style.pointerEvents),f=(l=$.Component,i=_,"function"!=typeof(u=l)&&null!==u||(i.prototype=Object.create(u&&u.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(i,u):i.__proto__=u)),_.prototype.componentDidMount=function(){this.pollInputElement()},_.prototype.componentWillUnmount=function(){clearTimeout(this.$pollInput)},_.prototype.pollInputElement=function(){var e=this;this.getDirectInputChanges(),this.$pollInput=setTimeout(function(){e.pollInputElement()},100)},_.prototype.getDirectInputChanges=function(){var e=this.elementReferences[-1];e&&e.value!==this.state.query&&this.handleInputChange({target:{value:e.value}})},_.prototype.componentDidUpdate=function(e,t){var n=this.state.focused,r=null===n,o=t.focused!==n;o&&!r&&this.elementReferences[n].focus();var a=-1===n,i=o&&null===t.focused;if(a&&i){var u=this.elementReferences[n];u.setSelectionRange(0,u.value.length)}},_.prototype.hasAutoselect=function(){return!d()&&this.props.autoselect},_.prototype.templateInputValue=function(e){var t=this.props.templates&&this.props.templates.inputValue;return t?t(e):e},_.prototype.templateSuggestion=function(e){var t=this.props.templates&&this.props.templates.suggestion;return t?t(e):e},_.prototype.handleComponentBlur=function(e){var t=this.state,n=t.options,r=t.query,o=t.selected,a=void 0;this.props.confirmOnBlur?(a=e.query||r,this.props.onConfirm(n[o])):a=r,this.setState({focused:null,menuOpen:e.menuOpen||!1,query:a,selected:null})},_.prototype.handleOptionBlur=function(e,t){var n=this.state,r=n.focused,o=n.menuOpen,a=n.options,i=n.selected,u=null===e.relatedTarget,l=e.relatedTarget===this.elementReferences[-1],s=r!==t&&-1!==r;if(!s&&u||!s&&!l){var c=o&&d();this.handleComponentBlur({menuOpen:c,query:this.templateInputValue(a[i])})}},_.prototype.handleInputBlur=function(e){var t=this.state,n=t.focused,r=t.menuOpen,o=t.options,a=t.query,i=t.selected;if(-1===n){var u=r&&d(),l=d()?a:this.templateInputValue(o[i]);this.handleComponentBlur({menuOpen:u,query:l})}},_.prototype.handleInputChange=function(e){var n=this,t=this.props,r=t.minLength,o=t.source,a=t.showAllValues,i=this.hasAutoselect(),u=e.target.value,l=0===u.length,s=this.state.query.length!==u.length,c=u.length>=r;this.setState({query:u}),a||!l&&s&&c?o(u,function(e){var t=0<e.length;n.setState({menuOpen:t,options:e,selected:i&&t?0:-1})}):!l&&c||this.setState({menuOpen:!1,options:[]})},_.prototype.handleInputClick=function(e){this.handleInputChange(e)},_.prototype.handleInputFocus=function(e){this.setState({focused:-1})},_.prototype.handleOptionFocus=function(e){this.setState({focused:e,hovered:null,selected:e})},_.prototype.handleOptionMouseEnter=function(e,t){this.setState({hovered:t})},_.prototype.handleOptionMouseOut=function(e,t){this.setState({hovered:null})},_.prototype.handleOptionClick=function(e,t){var n=this.state.options[t],r=this.templateInputValue(n);this.props.onConfirm(n),this.setState({focused:-1,menuOpen:!1,query:r,selected:-1}),this.forceUpdate()},_.prototype.handleOptionMouseDown=function(e){e.preventDefault()},_.prototype.handleUpArrow=function(e){e.preventDefault();var t=this.state,n=t.menuOpen,r=t.selected;-1!==r&&n&&this.handleOptionFocus(r-1)},_.prototype.handleDownArrow=function(e){var t=this;if(e.preventDefault(),this.props.showAllValues&&!1===this.state.menuOpen)e.preventDefault(),this.props.source("",function(e){t.setState({menuOpen:!0,options:e,selected:0,focused:0,hovered:null})});else if(!0===this.state.menuOpen){var n=this.state,r=n.menuOpen,o=n.options,a=n.selected;a!==o.length-1&&r&&this.handleOptionFocus(a+1)}},_.prototype.handleSpace=function(e){var t=this;this.props.showAllValues&&!1===this.state.menuOpen&&(e.preventDefault(),this.props.source("",function(e){t.setState({menuOpen:!0,options:e})})),-1!==this.state.focused&&(e.preventDefault(),this.handleOptionClick(e,this.state.focused))},_.prototype.handleEnter=function(e){this.state.menuOpen&&(e.preventDefault(),0<=this.state.selected&&this.handleOptionClick(e,this.state.selected))},_.prototype.handlePrintableKey=function(e){var t=this.elementReferences[-1];e.target===t||t.focus()},_.prototype.handleKeyDown=function(e){switch(p[e.keyCode]){case"up":this.handleUpArrow(e);break;case"down":this.handleDownArrow(e);break;case"space":this.handleSpace(e);break;case"enter":this.handleEnter(e);break;case"escape":this.handleComponentBlur({query:this.state.query});break;default:!function(e){return 47<e&&e<58||32===e||8===e||64<e&&e<91||95<e&&e<112||185<e&&e<193||218<e&&e<223}(e.keyCode)||this.handlePrintableKey(e)}},_.prototype.render=function(){var o=this,e=this.props,t=e.cssNamespace,n=e.displayMenu,a=e.id,r=e.minLength,i=e.name,u=e.placeholder,l=e.required,s=e.showAllValues,c=e.tNoResults,d=e.tStatusQueryTooShort,p=e.tStatusNoResults,f=e.tStatusSelectedOption,_=e.tStatusResults,h=e.dropdownArrow,m=this.state,v=m.focused,g=m.hovered,b=m.menuOpen,y=m.options,O=m.query,E=m.selected,C=this.hasAutoselect(),x=-1===v,A=0===y.length,T=0!==O.length,N=O.length>=r,w=this.props.showNoOptionsFound&&x&&A&&T&&N,D=t+"__wrapper",R=t+"__input",S=null!==v?" "+R+"--focused":"",I=this.props.showAllValues?" "+R+"--show-all-values":" "+R+"--default",k=t+"__dropdown-arrow-down",P=-1!==v&&null!==v,L=t+"__menu",q=L+"--"+n,j=L+"--"+(b||w?"visible":"hidden"),M=t+"__option",B=t+"__hint",V=this.templateInputValue(y[E]),U=V&&0===V.toLowerCase().indexOf(O.toLowerCase())&&C?O+V.substr(O.length):"",F=K&&U,G=void 0;return s&&"string"==typeof(G=h({className:k}))&&(G=(0,$.createElement)("div",{className:t+"__dropdown-arrow-down-wrapper",dangerouslySetInnerHTML:{__html:G}})),(0,$.createElement)("div",{className:D,onKeyDown:this.handleKeyDown,role:"combobox","aria-expanded":b?"true":"false"},(0,$.createElement)(W.default,{length:y.length,queryLength:O.length,minQueryLength:r,selectedOption:this.templateInputValue(y[E]),tQueryTooShort:d,tNoResults:p,tSelectedOption:f,tResults:_}),F&&(0,$.createElement)("span",null,(0,$.createElement)("input",{className:B,readonly:!0,tabIndex:"-1",value:U})),(0,$.createElement)("input",H({"aria-activedescendant":!!P&&a+"__option--"+v,"aria-owns":a+"__listbox",autoComplete:"off",className:R+S+I,id:a,onClick:function(e){return o.handleInputClick(e)},onBlur:this.handleInputBlur},function(e){return{onInput:e}}(this.handleInputChange),{onFocus:this.handleInputFocus,name:i,placeholder:u,ref:function(e){o.elementReferences[-1]=e},type:"text",role:"textbox",required:l,value:O})),G,(0,$.createElement)("ul",{className:L+" "+q+" "+j,id:a+"__listbox",role:"listbox"},y.map(function(e,t){var n=(-1===v?E===t:v===t)&&null===g?" "+M+"--focused":"",r=t%2?" "+M+"--odd":"";return(0,$.createElement)("li",{"aria-selected":v===t,className:M+n+r,dangerouslySetInnerHTML:{__html:o.templateSuggestion(e)},id:a+"__option--"+t,key:t,onFocusOut:function(e){return o.handleOptionBlur(e,t)},onClick:function(e){return o.handleOptionClick(e,t)},onMouseDown:o.handleOptionMouseDown,onMouseEnter:function(e){return o.handleOptionMouseEnter(e,t)},onMouseOut:function(e){return o.handleOptionMouseOut(e,t)},ref:function(e){o.elementReferences[t]=e},role:"option",tabIndex:"-1"})}),w&&(0,$.createElement)("li",{className:M+" "+M+"--no-results"},c())))},a=o=_,o.defaultProps={autoselect:!1,cssNamespace:"autocomplete",defaultValue:"",displayMenu:"inline",minLength:0,name:"input-autocomplete",placeholder:"",onConfirm:function(){},confirmOnBlur:!0,showNoOptionsFound:!0,showAllValues:!1,required:!1,tNoResults:function(){return"No results found"},dropdownArrow:c.default},a);function _(e){var t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,l.call(this,e));return t.elementReferences={},t.state={focused:null,hovered:null,menuOpen:!1,options:e.defaultValue?[e.defaultValue]:[],query:e.defaultValue,selected:null},t.handleComponentBlur=t.handleComponentBlur.bind(t),t.handleKeyDown=t.handleKeyDown.bind(t),t.handleUpArrow=t.handleUpArrow.bind(t),t.handleDownArrow=t.handleDownArrow.bind(t),t.handleEnter=t.handleEnter.bind(t),t.handlePrintableKey=t.handlePrintableKey.bind(t),t.handleOptionBlur=t.handleOptionBlur.bind(t),t.handleOptionClick=t.handleOptionClick.bind(t),t.handleOptionFocus=t.handleOptionFocus.bind(t),t.handleOptionMouseDown=t.handleOptionMouseDown.bind(t),t.handleOptionMouseEnter=t.handleOptionMouseEnter.bind(t),t.handleOptionMouseOut=t.handleOptionMouseOut.bind(t),t.handleInputBlur=t.handleInputBlur.bind(t),t.handleInputChange=t.handleInputChange.bind(t),t.handleInputFocus=t.handleInputFocus.bind(t),t.pollInputElement=t.pollInputElement.bind(t),t.getDirectInputChanges=t.getDirectInputChanges.bind(t),t}t.default=f},function(e,t,n){"use strict";function a(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}t.__esModule=!0,t.default=void 0;var r,o,i,u,l,_=n(0),s=(l=_.Component,i=c,"function"!=typeof(u=l)&&null!==u||(i.prototype=Object.create(u&&u.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(i,u):i.__proto__=u)),c.prototype.componentWillReceiveProps=function(e){e.queryLength!==this.props.queryLength&&this.setState(function(e){return{bump:!e.bump}})},c.prototype.render=function(){var e,t=this.props,n=t.length,r=t.queryLength,o=t.minQueryLength,a=t.selectedOption,i=t.tQueryTooShort,u=t.tNoResults,l=t.tSelectedOption,s=t.tResults,c=this.state.bump,d=r<o,p=0===n,f=a?l(a,n):"";return e=d?i(o):p?u():s(n,f),(0,_.createElement)("div",{"aria-atomic":"true","aria-live":"polite",role:"status",style:{border:"0",clip:"rect(0 0 0 0)",height:"1px",marginBottom:"-1px",marginRight:"-1px",overflow:"hidden",padding:"0",position:"absolute",whiteSpace:"nowrap",width:"1px"}},e,(0,_.createElement)("span",null,c?",":",,"))},o=r=c,r.defaultProps={tQueryTooShort:function(e){return"Type in "+e+" or more characters for results."},tNoResults:function(){return"No search results."},tSelectedOption:function(e,t){return e+" (1 of "+t+") is selected."},tResults:function(e,t){return e+" "+(1===e?"result":"results")+" "+(1===e?"is":"are")+" available. "+t}},o);function c(){for(var e,t,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t=a(this,l.call.apply(l,[this].concat(r))),t.state={bump:!1},a(t,e)}t.default=s},function(e,t,n){"use strict";t.__esModule=!0;var r=n(0);t.default=function(e){var t=e.className;return(0,r.createElement)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",className:t,focusable:"false"},(0,r.createElement)("g",{stroke:"none",fill:"none","fill-rule":"evenodd"},(0,r.createElement)("polygon",{fill:"#000000",points:"0 0 22 0 11 17"})))}}],r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=1);function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var n,o}),DynamicResizingTextarea.prototype.init=function(){"addEventListener"in document&&"scrollHeight"in document.body&&"classList"in document.body&&Function.prototype.bind&&(this.element.classList.add("js-autoresize"),this.element.rows="1",this.updateHeight(),this.element.addEventListener("input",this.updateHeight.bind(this)))},DynamicResizingTextarea.prototype.updateHeight=function(){this.element.style.height="auto",this.element.style.height=this.element.scrollHeight+"px"},"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){for(var e=document.querySelectorAll('[data-module~="autoresize"]'),t=0;t<e.length;t++)new DynamicResizingTextarea(e[t]).init()});var govukGovernmentOrganisationsAutocomplete=function(r){r.source=function(e,t){var n=[].filter.call(r.selectElement.options,function(e){return""!=e.value}).map(function(e){var t=e.getAttribute("data-abbreviations");t=t?t.split("|"):[];var n=e.getAttribute("data-other-names");return n=n?n.split("|"):[],{current_name:e.label,abbreviations:t,other_names:n}}),o=e.trim().split(/\s+/).map(function(e){return new RegExp("\\b"+e,"i")});return t(n.map(function(e){var n=[e.current_name].concat(e.other_names).concat(e.abbreviations).filter(function(e){return e});e.resultPosition=null;for(var r=0;r<n.length;r++){var t=o.reduce(function(e,t){return matchPosition=n[r].search(t),-1<matchPosition&&(e.count+=1,(-1==e.lowestPosition||matchPosition<e.lowestPosition)&&(e.lowestPosition=matchPosition)),e},{count:0,lowestPosition:-1});t.count==o.length&&(null==e.resultPosition||t.lowestPosition<e.resultPosition)&&(e.resultPosition=t.lowestPosition)}return e}).filter(function(e){return null!=e.resultPosition}).sort(function(e,t){return e.resultPosition<t.resultPosition?-1:e.resultPosition>t.resultPosition?1:0}).map(function(e){return e.current_name}))},accessibleAutocomplete.enhanceSelectElement(r)};function ErrorSummaryWithStickyBanner(e,t){this.$module=e,this.$banner=t}ErrorSummaryWithStickyBanner.prototype.init=function(){if(this.$module&&this.$banner){function e(e){window.setTimeout(function(){var e=n.exec(this.getAttribute("href"));if(2===e.length){document.getElementById(e[1]).scrollIntoView();var t=r.clientHeight;window.scrollBy(0,-t)}}.bind(this),0)}for(var n=/\#(.+)$/,t=this.$module.querySelectorAll("a"),r=this.$banner,o=0;o<t.length;o++)t[o].addEventListener("click",e)}};var $validationErrorBox=document.querySelector(".govuk-error-summary"),$stickyStatusBanner=document.querySelector(".status-banner.sticky-js");function showHideControl(o){if(document.querySelectorAll&&Function.prototype.bind&&"classList"in document.createElement("_")){o=o;var a=null;!function(){var e=o.getAttribute("aria-controls"),t=o.getAttribute("name");e&&(a=document.getElementById(e));if(a)for(var n=document.querySelectorAll("input[name="+t+"]"),r=n.length-1;0<=r;r--)n[r].addEventListener("change",u.bind(this));i(o.checked)}()}function i(e){e?a.classList.remove("js-hidden"):a.classList.add("js-hidden")}function u(e){i(o.checked),o.setAttribute("aria-expanded",o.checked)}}function NoNewlinesTextarea(e){this.element=e}function ukCountriesSelect(e){var o,a;function i(e){checkedCountries=Array.prototype.slice.apply(o).filter(function(e){return e.checked&&e.value!=Overseas}).map(function(e){return e.value}),a.checked=0===UKCountries.filter(function(e){return!(-1<checkedCountries.indexOf(e))}).length}function u(){for(var e=o.length-1;0<=e;e--)"OVERSEAS"!==o[e].value&&(o[e].checked=a.checked)}this.element=e,UKCountries=["ENGLAND","WALES","SCOTLAND","NORTHERN_IRELAND"],Overseas="OVERSEAS",function(){if(!(this.element&&"querySelector"in this.element&&"querySelectorAll"in this.element))return;(a=document.createElement("input")).setAttribute("class","govuk-checkboxes__input"),a.setAttribute("type","checkbox"),a.setAttribute("id","uk");var e=document.createElement("label");e.setAttribute("class","govuk-label govuk-checkboxes__label"),e.setAttribute("for","uk"),e.textContent="United Kingdom";var t=document.createElement("div");if(t.setAttribute("class","govuk-checkboxes__item uk"),t.appendChild(a),t.appendChild(e),!this.element.querySelector("legend"))return console.warn("missing legend for UK fieldset");var n=Array.prototype.slice.apply(document.querySelectorAll(".govuk-checkboxes .govuk-checkboxes__item")).filter(function(e){return e.textContent.match("Overseas")})[0];if(this.element.querySelector(".govuk-checkboxes").insertBefore(t,n),a){a.addEventListener("change",u);for(var r=(o=this.element.querySelectorAll("input.country")).length-1;0<=r;r--)o[r].addEventListener("change",i);i()}}()}null!=$validationErrorBox&&null!=$stickyStatusBanner&&new ErrorSummaryWithStickyBanner($validationErrorBox,$stickyStatusBanner).init(),NoNewlinesTextarea.prototype.init=function(){"addEventListener"in document&&Function.prototype.bind&&(this.element.addEventListener("keypress",function(e){"Enter"==e.key&&e.preventDefault()}.bind(this)),this.element.addEventListener("input",this.stripNewlines.bind(this)),this.stripNewlines())},NoNewlinesTextarea.prototype.stripNewlines=function(){-1===this.element.value.indexOf("\r")&&-1===this.element.value.indexOf("\n")||(this.element.value=this.element.value.replace(/[\r\n]/gm,""))},"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){for(var e=document.querySelectorAll('[data-module~="no-newlines"]'),t=0;t<e.length;t++)new NoNewlinesTextarea(e[t]).init()});var DATA_ERROR_DUPLICATION="duplication",DATA_ERROR_MISSING_DATA="missing data",DATA_ERROR_SETTINGS_ERROR="settings",DATA_ERROR_COMPLEX_DATA="complex data";function validateData(e,t,n){var r=_.clone(e),o=r.shift(),a=_.map(o,function(e){return e.trim().toLowerCase()}),i=index_of_column_named(a,t);if(null===i)return[{error:"could not find data column",column:t,errorType:DATA_ERROR_SETTINGS_ERROR}];if(null===n)return validateSimpleData(r,i,t);var u=index_of_column_named(a,n);return null===u?[{error:"could not find data column",column:n,errorType:DATA_ERROR_SETTINGS_ERROR}]:validateGroupedData(r,i,u,t,n)}function validateDataDuplicatesOnly(e,t,n){var r=_.clone(e),o=r.shift(),a=_.map(o,function(e){return e.trim().toLowerCase()}),i=index_of_column_named(a,t);if(null===i)return[{error:"could not find data column",column:t}];if(null===n)return validateSimpleData(r,i);var u=index_of_column_named(a,n);return null===u?[{error:"could not find data column",column:n}]:validateGroupedDataDuplicates(r,i,u)}function validateSimpleData(e,n,r){var o=[],t=_.uniq(_.map(e,function(e){return e[n]}));if(t.length===e.length)return[];if(e.length%t.length==0)return[{errorType:DATA_ERROR_COMPLEX_DATA}];var a={};return _.forEach(e,function(e){var t=e[n];t in a?"added to errors"!==a[t]&&(o.push({error:"duplicate data",category:t,categoryColumn:r,errorType:DATA_ERROR_DUPLICATION}),a[t]="added to errors"):a[t]="value in dict"}),o}function validateGroupedData(e,t,n,r,o){var a=validateGroupedDataCompleteness(e,t,n,r,o),i=validateGroupedDataDuplicates(e,t,n,r,o);return a.concat(i)}function validateGroupedDataCompleteness(e,n,r,o,a){var t=_.uniq(_.map(e,function(e){return e[n]})),i=_.uniq(_.map(e,function(e){return e[r]})),u=[],l=_.object(_.map(t,function(t){return[t,_.map(_.filter(e,function(e){return e[n]===t}),function(e){return e[r]})]}));return _.forEach(t,function(t){_.forEach(i,function(e){_.contains(l[t],e)||u.push({error:"missing data",category:t,group:e,categoryColumn:o,groupColumn:a,errorType:DATA_ERROR_MISSING_DATA})})}),u}function validateGroupedDataDuplicates(e,r,o,a,i){var u=[],l={};return _.forEach(e,function(e){var t=e[r],n=e[o];t in l?n in l[t]?u.push({error:"duplicate data",category:e[r],group:e[o],categoryColumn:a,groupColumn:i,errorType:DATA_ERROR_DUPLICATION}):l[t][n]=1:(l[t]={},l[t][n]=1)}),u}function errorDescription(e){switch(e.errorType){case DATA_ERROR_SETTINGS_ERROR:return"Column '"+e.column+"' not found";case DATA_ERROR_MISSING_DATA:return"The data is missing a row for "+e.categoryColumn+" = '"+e.category+"' and "+e.groupColumn+" = '"+e.group+"'";case DATA_ERROR_DUPLICATION:return"group"in e?"The data has duplicate entries for the rows with "+e.categoryColumn+" = '"+e.category+"' and "+e.groupColumn+" = '"+e.group+"'":"The data has duplicate entries for "+e.categoryColumn+" = '"+e.category+"'"}}function errorResolutionHint(e){switch(e.errorType){case DATA_ERROR_SETTINGS_ERROR:return"Make sure the column values selected for this table are valid";case DATA_ERROR_MISSING_DATA:return"Add rows to your source spreadsheet and try again";case DATA_ERROR_DUPLICATION:return"Remove data rows in your source spreadsheet and try again"}}if("undefined"!=typeof exports){var _=require("../charts/vendor/underscore-min"),index_of_column_named=(dataTools=require("../charts/rd-data-tools")).index_of_column_named;exports.validateSimpleData=validateSimpleData,exports.validateGroupedData=validateGroupedData,exports.validateData=validateData,exports.DATA_ERROR_DUPLICATION=DATA_ERROR_DUPLICATION,exports.DATA_ERROR_MISSING_DATA=DATA_ERROR_MISSING_DATA,exports.DATA_ERROR_COMPLEX_DATA=DATA_ERROR_COMPLEX_DATA,exports.DATA_ERROR_SETTINGS_ERROR=DATA_ERROR_SETTINGS_ERROR}var defaultParentColor="#003078",defaultChildColor="#5694ca",VERSION="1.1",BAR_CHART="bar",LINE_CHART="line",COMPONENT_CHART="component",PANEL_BAR_CHART="panel_bar",PANEL_LINE_CHART="panel_line";function buildChartObject(e,t,n,r,o,a,i,u,l,s,c,d,p){var f=p||"[None]";switch(t.toLowerCase()){case BAR_CHART:var h=_.clone(e),m=h.shift();return o===f||null===o?barchartSingleObject(m,h,r,a,i,l,s,c,d):barchartDoubleObject(m,h,r,o,a,i,l,s,c,d);case LINE_CHART:return linechartObject(e,r,o,l,s,c,d,i);case COMPONENT_CHART:return componentChartObject(e,r,o,l,s,c,d,row_order_column,u);case PANEL_BAR_CHART:return panelBarchartObject(e,r,o,l,s,c,d,i,u);case PANEL_LINE_CHART:return panelLinechartObject(e,o,r,l,s,c,d,u);default:return null}}function barchartObject(e,t,n,r,o,a,i,u,l){var s=_.clone(e),c=s.shift();return isSimpleBarchart(n)?barchartSingleObject(c,s,t,r,o,a,i,u,l):barchartDoubleObject(c,s,t,n,r,o,a,i,u,l)}function isSimpleBarchart(e){return"[None]"===e||null===e}function barchartSingleObject(e,t,n,r,o,a,i,u,l){var s=getIndices(e,n,null,r,o),c=uniqueCategories(t,s.category,s.order),d=_.map(c,function(e){return valueForCategory(t,s.category,s.value,s.parent,e)}),p=[];return null!==s.parent&&(p=_.unique(_.map(t,function(e){return e[s.parent]}))),{type:"bar",title:{text:a},parent_child:null!==s.parent,xAxis:{title:{text:i},categories:c},yAxis:{title:{text:u}},series:[{name:n,data:d}],number_format:l,parents:p,version:VERSION}}function barchartDoubleObject(e,o,t,n,r,a,i,u,l,s){var c=getIndices(e,t,n,r,a),d=uniqueCategories(o,c.category,c.order),p=uniqueDataInColumnMaintainOrder(o,c.secondary),f=[];return p.forEach(function(t){var n=_.filter(o,function(e){return e[c.secondary]===t}),r=[];_.forEach(d,function(e){r.push(valueForCategory(n,c.category,c.value,c.parent,e))}),f.push({name:t,data:r})}),{type:"bar",title:{text:i},xAxis:{title:{text:u},categories:d},yAxis:{title:{text:l}},series:sortChartSeries(f),number_format:s,version:VERSION}}function linechartObject(e,t,n,r,o,a,i,u){var l=_.clone(e),s=getIndices(l.shift(),t,n,null,null,"[None]"===u?null:u),c=uniqueDataInColumnMaintainOrder(l,s.category),d=uniqueDataInColumnMaintainOrder(l,s.secondary),p=s.secondary,f=s.custom;if(f){var h=_.map(d,function(t){var e=_.findIndex(l,function(e){return e[p]===t});return l[e][f]});d=_.map(_.sortBy(_.zip(d,h),function(e){return e[1]}),function(e){return e[0]})}var m=[];return _.forEach(d,function(t){var n=[];_.forEach(c,function(e){n.push(valueForCategoryAndSeries(l,s.category,e,s.secondary,t,s.value))}),m.push({name:t,data:n})}),{type:"line",title:{text:r},xAxis:{title:{text:o},categories:c},yAxis:{title:{text:a}},series:sortChartSeries(m),number_format:i,version:VERSION}}function componentChartObject(e,t,n,r,o,a,i,u,l){var s=_.clone(e),c=getIndices(s.shift(),t,n,null,u,l),d=null;d=isUndefinedOrNull(u)||"[None]"===u?uniqueDataInColumnMaintainOrder(s,c.category):uniqueDataInColumnOrdered(s,c.category,c.order);var p=(isUndefinedOrNull(l)||"[None]"===l?uniqueDataInColumnMaintainOrder(s,c.secondary).reverse():uniqueDataInColumnOrdered(s,c.secondary,c.custom).reverse()).map(function(t){var e=d.map(function(e){return valueForCategoryAndSeries(s,c.category,e,c.secondary,t,c.value)});return{name:t,data:e}});return{type:"component",title:{text:r},xAxis:{title:{text:o},categories:d},yAxis:{title:{text:a}},series:p,number_format:i,version:VERSION}}function panelBarchartObject(e,r,t,n,o,a,i,u,l){var s=_.clone(e),c=getIndices(s.shift(),r,t,null,u,l),d=uniqueCategories(s,c.category,c.order),p=(isUndefinedOrNull(l)||"[None]"===l?uniqueDataInColumnMaintainOrder(s,c.secondary):uniqueDataInColumnOrdered(s,c.secondary,c.custom)).map(function(t){var n=_.filter(s,function(e){return e[c.secondary]===t}),e=d.map(function(e){return valueForCategory(n,c.category,c.value,c.parent,e)});return{type:"small_bar",title:{text:t},xAxis:{title:{text:o},categories:d},yAxis:{title:{text:a}},series:[{name:r,data:e}],number_format:i}});return{type:"panel_bar_chart",title:{text:n},xAxis:{title:{text:o},categories:d},yAxis:{title:{text:a}},panels:p,version:VERSION}}function panelLinechartObject(e,t,n,r,o,a,i,u){var l=_.clone(e),s=getIndices(l.shift(),n,t,null,null,u),c=null;c=isUndefinedOrNull(u)||"[None]"===u?uniqueDataInColumnMaintainOrder(l,s.category):uniqueDataInColumnOrdered(l,s.category,s.custom);var d=uniqueDataInColumnMaintainOrder(l,s.secondary);return{type:"panel_line_chart",title:{text:r},panels:_.map(c,function(t){var e=_.map(d,function(e){return valueForCategoryAndSeries(l,s.secondary,e,s.category,t,s.value)});return{type:"line",title:{text:t},xAxis:{title:{text:o},categories:d},yAxis:{title:{text:a}},series:[{name:t,data:e}],number_format:i}}),number_format:i,version:VERSION}}function getIndices(e,t,n,r,o,a){var i=_.map(e,function(e){return e.trim().toLowerCase()}),u=isUndefinedOrNull(t)?null:index_of_column_named(i,t),l=isUndefinedOrNull(o)?u:index_of_column_named(i,o),s=isUndefinedOrNull(r)?null:index_of_column_named(i,r),c=isUndefinedOrNull(n)?null:index_of_column_named(i,n),d=isUndefinedOrNull(a)?null:index_of_column_named(i,a);return{category:0<=u?u:null,order:0<=l?l:null,secondary:0<=c?c:null,value:index_of_column_named(i,"value"),parent:0<=s?s:null,custom:0<=d?d:null}}function uniqueCategories(e,t,n){return n?uniqueDataInColumnOrdered(e,t,n):uniqueDataInColumnMaintainOrder(e,t)}function valueForCategory(e,t,n,r,o){var a=e.filter(function(e){return e[t]===o});if(0===a.length)return{y:0,category:o};var i=a[0];if(i[t]===o){var u=isNumber(i[n]);if(r){var l=i[r],s={is_parent:l===o,is_child:l!==o,parent:l};return s.is_parent?{y:u?parseFloat(i[n]):0,relationships:s,category:i[t],color:defaultParentColor,text:u?"number":i[n]}:{y:u?parseFloat(i[n]):0,relationships:s,category:i[t],color:defaultChildColor,text:u?"number":i[n]}}return{y:u?parseFloat(i[n]):0,category:i[t],text:u?"number":i[n]}}}function valueForCategoryAndSeries(e,t,n,r,o,a){var i=_.filter(e,function(e){return e[t]===n&&e[r]===o});return 0<i.length?parseFloat(i[0][a]):0}function isNumber(e){return!isNaN(parseFloat(e))}function isUndefinedOrNull(e){return null==e}function sortChartSeries(e){return 0<e.filter(function(e){return isNaN(toNumberSortValue(e.name))}).length?e:(e.forEach(function(e){e.name_value=toNumberSortValue(e.name)}),_.sortBy(e,function(e){return e.name_value}))}function toNumberSortValue(e){var t=parseFloat(e);return isNaN(t)?parseFloat(e.substring(1)):t}if("undefined"!=typeof exports){_=require("../charts/vendor/underscore-min");var dataTools=require("../charts/rd-data-tools"),builderTools=require("../cms/rd-builder"),uniqueDataInColumnMaintainOrder=(index_of_column_named=dataTools.index_of_column_named,dataTools.uniqueDataInColumnMaintainOrder),getColumnIndex=builderTools.getColumnIndex;exports.barchartObject=barchartObject,exports.linechartObject=linechartObject,exports.componentChartObject=componentChartObject,exports.panelLinechartObject=panelLinechartObject,exports.panelBarchartObject=panelBarchartObject}var NONE_VALUE="[None]";function buildTableObject(e,t,n,r,o,a,i,u,l,s,c,d){return preProcessTableObject(i&&i!==NONE_VALUE?groupedTable(e,t,n,r,o,a,i,l,u,s,c,d):simpleTable(e,t,n,r,o,a,l,u,s,c))}function preProcessTableObject(e){return"simple"===e.type?preProcessSimpleTableObject(e):"grouped"===e.type&&preProcessGroupedTableObject(e),e}function simpleTable(e,t,n,r,o,a,i,u,l,s){var c=_.clone(e),d=c.shift(),p=_.map(d,function(e){return e.trim().toLowerCase()}),f=index_of_column_named(p,o),h=_.map(i,function(e){return index_of_column_named(p,e)}),m=f,v=!1;if(a&&a!==NONE_VALUE&&(m=index_of_column_named(p,a),v=!0),u&&u!==NONE_VALUE)var g=index_of_column_named(p,u);var b=_.map(c,function(t,e){var n={is_parent:!1,is_child:!1,parent:t[f]};if(v){var r=t[m],o=t[f];n={is_parent:r===o,is_child:r!==o,parent:r}}var a=_.map(h,function(e){return t[e]}),i=_.map(a,function(e){return numVal(e)});return g?{category:t[f],relationships:n,order:t[g],values:a,sort_values:i}:{category:t[f],relationships:n,order:e,values:a,sort_values:i}});return b=_.sortBy(b,function(e){return e.order}),v&&(b=adjustSimpleTableDataForParents(b)),{type:"simple",parent_child:v,header:t,subtitle:n,footer:r,category:o,columns:l,data:b,category_caption:s||o}}function preProcessSimpleTableObject(e){var t=columnDecimalPlaces(e),n=columnCouldBeAYear(e);e.data=_.map(e.data,function(e){return e.values=_.map(_.zip(e.values,t,n),function(e){return!1===e[2]?formatNumberWithDecimalPlaces(e[0],e[1]):e[0]}),e})}function columnDecimalPlaces(e){var t=[];for(var n in e.data[0].values){var r=_.map(e.data,function(e){return e.values[n]});t.push(seriesDecimalPlaces(r))}return t}function columnCouldBeAYear(e){var t=[];for(var n in e.data[0].values){var r=_.map(e.data,function(e){return e.values[n]});t.push(seriesCouldBeYear(r))}return t}function adjustSimpleTableDataForParents(e){return reorderSimpleTableDataForParentChild(addMissingSimpleTableParentItems(e))}function addMissingSimpleTableParentItems(o){var e=_.uniq(_.map(o,function(e){return e.relationships.parent})),t=_.map(o,function(e){return e.category}),n=_.filter(e,function(e){return!_.contains(t,e)}),a=_.clone(o),i=o[0];return _.forEach(n,function(t){var e=_.filter(o,function(e){return e.relationships.parent===t}),n=_.min(_.map(e,function(e){return e.order}))-1,r={category:t,order:n,relationships:{is_child:!1,is_parent:!0,parent:t},sort_values:_.map(i.sort_values,function(e){return 0}),values:_.map(i.values,function(e){return""})};a.push(r)}),a}function reorderSimpleTableDataForParentChild(n){var r=_.object(_.map(n,function(e){return[e.category,e]})),e=_.uniq(_.map(n,function(e){return e.relationships.parent})),o=[];return _.forEach(e,function(t){o.push(r[t]);var e=_.filter(n,function(e){return e.category!==t&&e.relationships.parent===t});o=o.concat(e)}),o}function groupedTable(e,t,n,r,o,a,i,u,l,s,c,d){var p=_.clone(e),f=p.shift(),h=_.map(f,function(e){return e.trim().toLowerCase()}),m=index_of_column_named(h,o),v=_.map(u,function(e){return index_of_column_named(h,e)}),g=index_of_column_named(h,i),b=null;b=null===l?m:index_of_column_named(h,l!==NONE_VALUE?l:o);var y=m,O=!1;a&&a!==NONE_VALUE&&(y=index_of_column_named(h,a),O=!0);var E=buildDataObjectsByGroup(getDataByGroup(p,g,d,f),p,g,m,O,y,b,v),C=templateGroupTable(o,t,s,E=adjustGroupedTableDataForParents(E)),x=[""].concat(_.map(C.groups,function(e){return e.group})),A=_.map(C.groups[0].data,function(e){return e.category}),T=_.map(A,function(e){return dataItemWithCategory(C,e)});return{group_columns:x,type:"grouped",category:o,group_column:i,columns:s,data:T=_.sortBy(T,function(e){return e.order}),header:t,subtitle:n,footer:r,groups:E=_.map(E,function(e){return e.data=_.sortBy(e.data,function(e){return e.order}),e}),parent_child:O,category_caption:c||o}}function preProcessGroupedTableObject(e){var o=groupedTableDecimalPlaces(e),a=groupedTableCouldBeAYear(e);for(var t in e.groups=_.map(e.groups,function(e){return e.data=_.map(e.data,function(e){return e.values=_.map(_.zip(e.values,o,a),function(e){return!1===e[2]?formatNumberWithDecimalPlaces(e[0],e[1]):e[0]}),e}),e}),e.data=[],e.groups[0].data){var n=_.clone(e.groups[0].data[t]);n.values=_.flatten(_.map(e.groups,function(e){return e.data[t].values})),n.sort_values=_.flatten(_.map(e.groups,function(e){return e.data[t].sort_values})),e.data.push(n)}var r=_.sortBy(e.groups[0].data,function(e){return e.order}),i=_.map(r,function(e){return e.category});_.forEach(i,function(n){var r="<tr><th>"+n+"</th>";_.forEach(e.groups,function(e){var t=_.findWhere(e.data,{category:n});_.forEach(_.zip(t.values,o,a),function(e){r=e[2]?r+"<td>"+e[0]+"</td>":r+"<td>"+formatNumberWithDecimalPlaces(e[0],e[1])+"</td>"})})})}function groupedTableDecimalPlaces(e){var t=[];for(var n in e.groups[0].data[0].values){var r=_.flatten(_.map(e.groups,function(e){return _.map(e.data,function(e){return e.values[n]})}));t.push(seriesDecimalPlaces(r))}return t}function groupedTableCouldBeAYear(e){var t=[];for(var n in e.groups[0].data[0].values){var r=_.flatten(_.map(e.groups,function(e){return _.map(e.data,function(e){return e.values[n]})}));t.push(seriesCouldBeYear(r))}return t}function buildDataObjectsByGroup(e,r,o,l,s,c,d,p){return _.map(e,function(t){var e=_.filter(r,function(e){return e[o]===t}),n=_.map(e,function(t,e){var n={is_parent:!1,is_child:!1,parent:t[l]};if(s){var r=t[c],o=t[l];n={is_parent:r===o,is_child:r!==o,parent:r}}var a=t[d],i=_.map(p,function(e){return t[e]}),u=_.map(i,function(e){return numVal(e)});return{category:t[l],relationships:n,order:a,values:i,sort_values:u}});return{group:t,data:n}})}function getDataByGroup(n,r,e,t){var o=uniqueDataInColumnMaintainOrder(n,r);if(e&&e!==NONE_VALUE){var a=t.indexOf(e),i=_.map(o,function(t){var e=_.findIndex(n,function(e){return e[r]===t});return n[e][a]});o=_.map(_.sortBy(_.zip(o,i),function(e){return e[1]}),function(e){return e[0]})}return o}function dataItemWithCategory(e,n){var r=[],o="",a="",i={};_.forEach(e.groups,function(e){var t=_.findWhere(e.data,{category:n});o=t.order,a=t.parent,i=t.relationships,_.forEach(t.values,function(e){r.push(e)})});var t=_.map(r,function(e){return numVal(e)});return{category:n,relationships:i,parent:a,order:o,values:r,sort_values:t}}function templateGroupTable(e,t,n,r){return{type:"grouped",category:e,title:{text:"Grouped Table"},header:t,columns:n,groups:r}}function adjustGroupedTableDataForParents(e){return reorderGroupedTableDataForParentChild(addMissingGroupedTableParentItems(e))}function addMissingGroupedTableParentItems(t){var e=_.uniq(_.flatten(_.map(t,function(e){return _.map(e.data,function(e){return e.relationships.parent})}))),n=_.uniq(_.flatten(_.map(t,function(e){return _.map(e.data,function(e){return e.category})}))),r=_.filter(e,function(e){return!_.contains(n,e)}),o=_.clone(t),a=t[0].data[0];return _.forEach(r,function(n){var e=_.filter(_.flatten(_.map(t,function(e){return e.data})),function(e){return e.relationships.parent===n}),r=_.min(_.map(e,function(e){return e.order}))-1;_.forEach(o,function(e){var t={category:n,order:r,relationships:{is_child:!1,is_parent:!0,parent:n},sort_values:_.map(a.sort_values,function(e){return 0}),values:_.map(a.values,function(e){return""})};e.data.push(t)})}),o}function reorderGroupedTableDataForParentChild(e){_.object(_.map(e,function(e){return[e.category,e]}));var t=_.uniq(_.flatten(_.map(e,function(e){return _.map(e.data,function(e){return e.relationships.parent})})));return _.forEach(e,function(n){var r=_.object(_.map(n.data,function(e){return[e.category,e]})),o=[];_.forEach(t,function(t){o.push(r[t]);var e=_.filter(n.data,function(e){return e.category!==t&&e.relationships.parent===t});o=o.concat(e)}),n.data=o}),e}function numVal(e,t){var n=String(e).replace(/\,/g,""),r=Number(n);return r||e}if("undefined"!=typeof exports){_=require("../charts/vendor/underscore-min"),dataTools=require("../charts/rd-data-tools"),builderTools=require("../cms/rd-builder"),uniqueDataInColumnMaintainOrder=dataTools.uniqueDataInColumnMaintainOrder;var seriesDecimalPlaces=dataTools.seriesDecimalPlaces,seriesCouldBeYear=dataTools.seriesCouldBeYear,formatNumberWithDecimalPlaces=dataTools.formatNumberWithDecimalPlaces;getColumnIndex=builderTools.getColumnIndex,index_of_column_named=dataTools.index_of_column_named;exports.buildTableObject=buildTableObject,exports.simpleTable=simpleTable,exports.groupedTable=groupedTable}function drawTable(e,t){return preProcessTableObject(t),"simple"===t.type?simpleHtmlTable(e,t):"grouped"===t.type?groupedHtmlTable(e,t):void 0}function simpleHtmlTable(e,t){var n="";return n=appendSimpleTableBody(n=appendSimpleTableHeader(n+="<table class='govuk-table eff-table--dense'>",t),t),n+="</table>",document.getElementById(e).innerHTML=n,!0}function appendSimpleTableHeader(e,t){var n="";return n=null==t.category_caption?"<thead class='govuk-table__head'><tr class='govuk-table__row'><td></td>":"<thead class='govuk-table__head'><tr class='govuk-table__row'><th class='govuk-table__header' scope='col'>"+t.category_caption+"</th>",_.forEach(t.columns,function(e){n=n+'<th class="govuk-table__header" scope="col">'+e+"</th>"}),e+(n+="</tr></thead>")}function appendSimpleTableBody(e,t){var n="<tbody class='govuk-table__body'>";return _.forEach(t.data,function(e){n+="<tr class='govuk-table__row'>",t.parent_child?e.relationships.is_parent?n+='<th class="govuk-table__header parent_row" scope="row">':n+='<th class="govuk-table__header child_row" scope="row">':n+='<th class="govuk-table__header" scope="row">',n=n+e.category+"</th>",_.forEach(e.values,function(e){n=n+'<td class="govuk-table__cell">'+e+"</td>"}),n+="</tr>"}),e+(n+="</tbody>")}function groupedHtmlTable(e,t){var n="";return n=appendGroupedTableBody(n=appendGroupTableHeader(n+="<table class='govuk-table eff-table--dense'>",t),t),n=insertTableFooter(n+="</table>",t),document.getElementById(e).innerHTML=n,!0}function appendGroupedTableBody(e,t){var o='<tbody class="govuk-table__body">',n=_.sortBy(t.groups[0].data,function(e){return e.order});return _.forEach(n,function(e){var n=e.category,r='<tr class="govuk-table__row">';t.parent_child?e.relationships.is_parent?r+='<th class="govuk-table__header parent_row" scope="row">':r+='<th class="govuk-table__header child_row" scope="row">':r+='<th class="govuk-table__header" scope="row">',r=r+n+"</th>",_.forEach(t.groups,function(e){var t=_.findWhere(e.data,{category:n});_.forEach(t.values,function(e){r=r+'<td class="govuk-table__cell">'+e+"</td>"})}),o+=r+="</tr>"}),e+(o+="</tbody>")}function appendGroupTableHeader(e,t){var n=!1;_.forEach(t.columns,function(e){""!==e&&(n=!0)});var r="";return r=n||null==t.category_caption?"<thead class='govuk-table__head'><tr class='govuk-table__row'><td></td>":"<thead class='govuk-table__head'><tr class='govuk-table__row'><th class='govuk-table__header' scope='col'>"+t.category_caption+"</th>",_.forEach(t.groups,function(e){r+=multicell_th(e.group,t.columns.length)}),r+="</tr>",n&&(null!=t.category_caption?r=r+"<tr class='govuk-table__row'><th class='govuk-table__header'>"+t.category_caption+"</th>":r+='<tr class="govuk-table__row"><td></td>',_.forEach(t.groups,function(e){_.forEach(t.columns,function(e){r=r+'<th class="govuk-table__header">'+e+"</th>"})}),r+="</tr>"),e+(r+="</thead>")}function insertTableFooter(e,t){return t.footer&&""!==t.footer?e+"<div class='table-footer'>"+t.footer+"</div>":e}function multicell_th(e,t){return'<th class="govuk-table__header" scope="col" colspan='+t+">"+e+"</th>"}$(document).ready(function(){var e=$(".sticky-js");$.each(e,function(){var t=parseInt($(this).position().top);$(window).scroll(function(){var e=$(window).scrollTop();t<=e?$(this).addClass("sticky-js-fixed"):$(this).removeClass("sticky-js-fixed")}.bind(this))})});
//# sourceMappingURL=cms.js.map
